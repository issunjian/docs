import{_ as s,o as n,c as a,V as l}from"./chunks/framework.c6d8cbec.js";const p="/docs/assets/validator-9585b744-a942-425f-b78b-f92f22909c6c.7beefed9.png",o="/docs/assets/validator-5b9e4758-27ff-4773-a4b3-809b8dd6546c.0cabd250.png",e="/docs/assets/validator-2b0b00c2-fc10-40dc-bfc7-c615bd87f9c9.82554c23.png",t="/docs/assets/validator-eaf30b98-0a9a-403f-8f2b-a159edc492d6.ff06fd0d.png",c="/docs/assets/validator-bc9d8ec7-bba6-4306-aaae-b6c66068366a.ec04a8ea.png",r="/docs/assets/validator-1dd4607e-689a-4ddf-814a-d92ac6408fc3.c82d5346.png",y="/docs/assets/validator-8d673f46-6981-4150-b549-29335bf90cf5.8ac855e5.png",F="/docs/assets/validator-fbd06343-c1ae-4cf6-9b46-bd5c9860b396.7225b339.png",h=JSON.parse('{"title":"SpringBootä¸­å¤„ç†æ ¡éªŒé€»è¾‘çš„ä¸¤ç§æ–¹å¼ï¼šHibernate Validator+å…¨å±€å¼‚å¸¸å¤„ç†","description":"","frontmatter":{"category":["Javaä¼ä¸šçº§å¼€å‘"],"tag":["Spring Boot"],"title":"SpringBootä¸­å¤„ç†æ ¡éªŒé€»è¾‘çš„ä¸¤ç§æ–¹å¼ï¼šHibernate Validator+å…¨å±€å¼‚å¸¸å¤„ç†","shortTitle":"SpringBootä¸­å¦‚ä½•å¤„ç†æ ¡éªŒé€»è¾‘"},"headers":[],"relativePath":"backend/tobetter/springboot/validator.md","filePath":"backend/tobetter/springboot/validator.md"}'),i={name:"backend/tobetter/springboot/validator.md"},E=l('<p>æœ€è¿‘æ­£åœ¨å¼€å‘ä¸€ä¸ªçŸ¥è¯†åº“å­¦ä¹ ç½‘ç«™ç¼–ç¨‹å–µğŸ±ï¼Œéœ€è¦å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œæ¯”å¦‚è¯´éç©ºå•Šã€é•¿åº¦é™åˆ¶å•Šç­‰ç­‰ï¼Œå¯é€‰çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>ä¸€ç§æ˜¯ç”¨ Hibernate Validator æ¥å¤„ç†</li><li>ä¸€ç§æ˜¯ç”¨å…¨å±€å¼‚å¸¸æ¥å¤„ç†</li></ul><p>ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸€ä¸€æ¥å®è·µä½“éªŒä¸€ä¸‹ã€‚</p><h3 id="ä¸€ã€hibernate-validator" tabindex="-1">ä¸€ã€Hibernate Validator <a class="header-anchor" href="#ä¸€ã€hibernate-validator" aria-label="Permalink to &quot;ä¸€ã€Hibernate Validator&quot;">â€‹</a></h3><p>Spring Boot å·²ç»å†…ç½®äº† Hibernate Validator æ ¡éªŒæ¡†æ¶ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ Spring Boot å®˜ç½‘æŸ¥çœ‹å’Œç¡®è®¤ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œè¿›å…¥ Spring Boot å®˜ç½‘ï¼Œç‚¹å‡» learn è¿™ä¸ªé¢æ¿ï¼Œç‚¹å‡»å‚è€ƒæ–‡æ¡£ã€‚</p><img src="'+p+'"><p>ç¬¬äºŒæ­¥ï¼Œåœ¨å‚è€ƒæ–‡æ¡£é¡µç‚¹å‡»ã€Œä¾èµ–çš„ç‰ˆæœ¬ã€ã€‚</p><img src="'+o+'"><p>ç¬¬ä¸‰æ­¥ï¼Œåœ¨ä¾èµ–ç‰ˆæœ¬é¡µå°±å¯ä»¥æŸ¥çœ‹åˆ°æ‰€æœ‰çš„ä¾èµ–äº†ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€‚</p><img src="'+e+`"><p>PSï¼šå¦‚æœå‘ç°æ²¡æœ‰èµ·æ•ˆï¼Œå¯èƒ½æ˜¯ä¾èµ–ç‰ˆæœ¬å†²çªäº†ï¼Œæ‰‹åŠ¨æŠŠ Hibernate Validator ä¾èµ–æ·»åŠ åˆ° pom.xml æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#f6f6f4;">&lt;dependency&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">    &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">    &lt;version&gt;6.0.17.Final&lt;/version&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">&lt;/dependency&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">&lt;dependency&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">    &lt;groupId&gt;javax.validation&lt;/groupId&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">    &lt;artifactId&gt;validation-api&lt;/artifactId&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">    &lt;version&gt;2.0.1.Final&lt;/version&gt;</span></span>
<span class="line"><span style="color:#f6f6f4;">&lt;/dependency&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">&lt;dependency&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;groupId&gt;org.hibernate.validator&lt;/groupId&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;version&gt;6.0.17.Final&lt;/version&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;/dependency&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;dependency&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;groupId&gt;javax.validation&lt;/groupId&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;artifactId&gt;validation-api&lt;/artifactId&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;version&gt;2.0.1.Final&lt;/version&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;/dependency&gt;</span></span></code></pre></div><p>é€šè¿‡ Hibernate Validator æ ¡éªŒæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¯·æ±‚å‚æ•°çš„å­—æ®µä¸ŠåŠ å…¥æ³¨è§£æ¥å®Œæˆæ ¡éªŒã€‚</p><p><strong>å…·ä½“è¯¥æ€ä¹ˆåšå‘¢</strong>ï¼Ÿ</p><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨éœ€è¦éªŒè¯çš„å­—æ®µä¸ŠåŠ ä¸Š Hibernate Validator æä¾›çš„æ ¡éªŒæ³¨è§£ã€‚</p><p>æ¯”å¦‚è¯´æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ç™»å½•çš„è¯·æ±‚å‚æ•° UsersLoginParam ç±»ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Data</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">ApiModel</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F286C4;">=</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç”¨æˆ·ç™»å½•</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, </span><span style="color:#BF9EEE;">description</span><span style="color:#F286C4;">=</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç”¨æˆ·è¡¨</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">UsersLoginParam</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">implements</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Serializable</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">final</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">long</span><span style="color:#F6F6F4;"> serialVersionUID </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">1L</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ApiModelProperty</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç™»å½•å</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">NotBlank</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">message</span><span style="color:#F286C4;">=</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç™»å½•åä¸èƒ½ä¸ºç©º</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> userLogin;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ApiModelProperty</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">å¯†ç </span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">NotBlank</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">message</span><span style="color:#F286C4;">=</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">å¯†ç ä¸èƒ½ä¸ºç©º</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> userPass;</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ApiModel</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;ç”¨æˆ·ç™»å½•&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;ç”¨æˆ·è¡¨&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UsersLoginParam</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Serializable</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> serialVersionUID </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1L</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ApiModelProperty</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ç™»å½•å&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">NotBlank</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">message</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;ç™»å½•åä¸èƒ½ä¸ºç©º&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String userLogin;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ApiModelProperty</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;å¯†ç &quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">NotBlank</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">message</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String userPass;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>å°±å¯ä»¥é€šè¿‡ <code>@NotBlank</code> æ³¨è§£æ¥å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œåˆ¤ç©ºæ ¡éªŒã€‚é™¤äº† <code>@NotBlank</code> æ³¨è§£ï¼ŒHibernate Validator è¿˜æä¾›äº†ä»¥ä¸‹å¸¸ç”¨æ³¨è§£ï¼š</p><ul><li><code>@NotNull</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µä¸èƒ½ä¸º nullï¼›</li><li><code>@NotEmpty</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µä¸èƒ½ä¸ºç©ºï¼›</li><li><code>@Min</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»å¤§äºç­‰äºå…¶valueå€¼ï¼›</li><li><code>@Max</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»å°äºç­‰äºå…¶valueå€¼ï¼›</li><li><code>@Size</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»åœ¨å…¶minå’Œmaxå€¼ä¹‹é—´ï¼›</li><li><code>@Pattern</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»ç¬¦åˆæ‰€å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼ï¼›</li><li><code>@Email</code>ï¼šè¢«æ³¨è§£çš„å­—æ®µå¿…é¡»ç¬¦åˆé‚®ç®±æ ¼å¼ã€‚</li></ul><p>ç¬¬äºŒæ­¥ï¼Œåœ¨å¯¹åº”çš„è¯·æ±‚æ¥å£ï¼ˆ<code>UsersController.login()</code>ï¼‰ä¸­æ·»åŠ  <code>@Validated</code> æ³¨è§£ï¼Œå¹¶æ³¨å…¥ä¸€ä¸ª <code>BindingResult</code> å‚æ•°ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Controller</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Api</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">tags</span><span style="color:#F286C4;">=</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç”¨æˆ·</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">RequestMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">/users</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">UsersController</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Autowired</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">IUsersService</span><span style="color:#F6F6F4;"> usersService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ApiOperation</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç™»å½•ä»¥åè¿”å›token</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">RequestMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">/login</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, </span><span style="color:#BF9EEE;">method</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> RequestMethod.POST)</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ResponseBody</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ResultObject</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">login</span><span style="color:#F6F6F4;">(@</span><span style="color:#97E1F1;font-style:italic;">Validated</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">UsersLoginParam</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">users</span><span style="color:#F6F6F4;">, </span><span style="color:#97E1F1;font-style:italic;">BindingResult</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">result</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> token </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> usersService.</span><span style="color:#62E884;">login</span><span style="color:#F6F6F4;">(users.</span><span style="color:#62E884;">getUserLogin</span><span style="color:#F6F6F4;">(), users.</span><span style="color:#62E884;">getUserPass</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (token </span><span style="color:#F286C4;">==</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">null</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> ResultObject.</span><span style="color:#62E884;">validateFailed</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">Map</span><span style="color:#F6F6F4;">&lt;String, String&gt; tokenMap </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">HashMap</span><span style="color:#F6F6F4;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#F6F6F4;">        tokenMap.</span><span style="color:#62E884;">put</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">token</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, token);</span></span>
<span class="line"><span style="color:#F6F6F4;">        tokenMap.</span><span style="color:#62E884;">put</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">tokenHead</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, tokenHead);</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> ResultObject.</span><span style="color:#62E884;">success</span><span style="color:#F6F6F4;">(tokenMap);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Controller</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Api</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">tags</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;ç”¨æˆ·&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/users&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UsersController</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> IUsersService usersService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ApiOperation</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ç™»å½•ä»¥åè¿”å›token&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/login&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">method</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> RequestMethod.POST)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ResponseBody</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> ResultObject </span><span style="color:#6F42C1;">login</span><span style="color:#24292E;">(@</span><span style="color:#D73A49;">Validated</span><span style="color:#24292E;"> UsersLoginParam </span><span style="color:#E36209;">users</span><span style="color:#24292E;">, BindingResult </span><span style="color:#E36209;">result</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        String token </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> usersService.</span><span style="color:#6F42C1;">login</span><span style="color:#24292E;">(users.</span><span style="color:#6F42C1;">getUserLogin</span><span style="color:#24292E;">(), users.</span><span style="color:#6F42C1;">getUserPass</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (token </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ResultObject.</span><span style="color:#6F42C1;">validateFailed</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; tokenMap </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292E;">        tokenMap.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;token&quot;</span><span style="color:#24292E;">, token);</span></span>
<span class="line"><span style="color:#24292E;">        tokenMap.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;tokenHead&quot;</span><span style="color:#24292E;">, tokenHead);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ResultObject.</span><span style="color:#6F42C1;">success</span><span style="color:#24292E;">(tokenMap);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>ç¬¬ä¸‰æ­¥ï¼Œä¸ºæ§åˆ¶å±‚ï¼ˆUsersControllerï¼‰åˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼Œå°†é€šçŸ¥æ³¨å…¥åˆ° BindingResult å¯¹è±¡ä¸­ï¼Œç„¶åå†åˆ¤æ–­æ˜¯å¦æœ‰æ ¡éªŒé”™è¯¯ï¼Œæœ‰é”™è¯¯çš„è¯è¿”å›æ ¡éªŒæç¤ºä¿¡æ¯ï¼Œå¦åˆ™æ”¾è¡Œã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Aspect</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Component</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Order</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">2</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">BindingResultAspect</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Pointcut</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">execution(public * com.codingmore.controller.*.*(..))</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">BindingResult</span><span style="color:#F6F6F4;">() {</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Around</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">BindingResult()</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Object</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">doAround</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">ProceedingJoinPoint</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">joinPoint</span><span style="color:#F6F6F4;">) </span><span style="color:#F286C4;">throws</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Throwable</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">Object</span><span style="color:#F6F6F4;">[] args </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> joinPoint.</span><span style="color:#62E884;">getArgs</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">for</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">Object</span><span style="color:#F6F6F4;"> arg </span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> args) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (arg </span><span style="color:#F286C4;">instanceof</span><span style="color:#F6F6F4;"> BindingResult) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#97E1F1;font-style:italic;">BindingResult</span><span style="color:#F6F6F4;"> result </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> (BindingResult) arg;</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (result.</span><span style="color:#62E884;">hasErrors</span><span style="color:#F6F6F4;">()) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#97E1F1;font-style:italic;">FieldError</span><span style="color:#F6F6F4;"> fieldError </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> result.</span><span style="color:#62E884;">getFieldError</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;">(fieldError</span><span style="color:#F286C4;">!=</span><span style="color:#BF9EEE;">null</span><span style="color:#F6F6F4;">){</span></span>
<span class="line"><span style="color:#F6F6F4;">                        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> ResultObject.</span><span style="color:#62E884;">validateFailed</span><span style="color:#F6F6F4;">(fieldError.</span><span style="color:#62E884;">getDefaultMessage</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">                    }</span><span style="color:#F286C4;">else</span><span style="color:#F6F6F4;">{</span></span>
<span class="line"><span style="color:#F6F6F4;">                        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> ResultObject.</span><span style="color:#62E884;">validateFailed</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">                    }</span></span>
<span class="line"><span style="color:#F6F6F4;">                }</span></span>
<span class="line"><span style="color:#F6F6F4;">            }</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> joinPoint.</span><span style="color:#62E884;">proceed</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Aspect</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Component</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Order</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BindingResultAspect</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Pointcut</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;execution(public * com.codingmore.controller.*.*(..))&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BindingResult</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Around</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;BindingResult()&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Object </span><span style="color:#6F42C1;">doAround</span><span style="color:#24292E;">(ProceedingJoinPoint </span><span style="color:#E36209;">joinPoint</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Throwable {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">Object</span><span style="color:#24292E;">[] args </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> joinPoint.</span><span style="color:#6F42C1;">getArgs</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (Object arg </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> args) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (arg </span><span style="color:#D73A49;">instanceof</span><span style="color:#24292E;"> BindingResult) {</span></span>
<span class="line"><span style="color:#24292E;">                BindingResult result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (BindingResult) arg;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (result.</span><span style="color:#6F42C1;">hasErrors</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">                    FieldError fieldError </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> result.</span><span style="color:#6F42C1;">getFieldError</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(fieldError</span><span style="color:#D73A49;">!=</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ResultObject.</span><span style="color:#6F42C1;">validateFailed</span><span style="color:#24292E;">(fieldError.</span><span style="color:#6F42C1;">getDefaultMessage</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">                    }</span><span style="color:#D73A49;">else</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ResultObject.</span><span style="color:#6F42C1;">validateFailed</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> joinPoint.</span><span style="color:#6F42C1;">proceed</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>è¿™é‡Œæ¶‰åŠåˆ°äº† Spring AOP çš„çŸ¥è¯†ï¼Œæˆ‘åœ¨å‰é¢çš„æ–‡ç« é‡Œè®²è§£è¿‡äº†ï¼Œæˆ³è¿™ä¸ªé“¾æ¥å¯ä»¥ç›´è¾¾ï¼š<a href="https://tobebetterjavaer.com/springboot/aop-log.html" target="_blank" rel="noreferrer">Spring AOP æ‰«ç›²</a></p><p>ç¬¬å››æ­¥ï¼Œè®¿é—®ç™»å½•æ¥å£ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½ä¸ä¼ å…¥çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šè¿”å›â€œç”¨æˆ·åä¸èƒ½ä¸ºç©ºâ€çš„æç¤ºä¿¡æ¯ã€‚</p><img src="`+t+'"><p>é€šè¿‡ debug çš„å½¢å¼ï¼Œä½“éªŒä¸€ä¸‹æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚</p><img src="'+c+`"><p>å¯ä»¥çœ‹å¾—å‡ºï¼ŒHibernate Validator å¸¦æ¥çš„ä¼˜åŠ¿æœ‰è¿™äº›ï¼š</p><ul><li>éªŒè¯é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘è¿›è¡Œäº†åˆ†ç¦»ï¼Œé™ä½äº†ç¨‹åºè€¦åˆåº¦ï¼›</li><li>ç»Ÿä¸€ä¸”è§„èŒƒçš„éªŒè¯æ–¹å¼ï¼Œæ— éœ€å†æ¬¡ç¼–å†™é‡å¤çš„éªŒè¯ä»£ç ã€‚</li></ul><p>ä¸è¿‡ï¼Œä¹Ÿå¸¦æ¥ä¸€äº›å¼Šç«¯ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>éœ€è¦åœ¨è¯·æ±‚æ¥å£çš„æ–¹æ³•ä¸­æ³¨å…¥ BindingResult å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹åº”åœ¨æ–¹æ³•ä½“ä¸­å¹¶æ²¡æœ‰ç”¨åˆ°</li><li>åªèƒ½æ ¡éªŒä¸€äº›éå¸¸ç®€å•çš„é€»è¾‘ï¼Œæ¶‰åŠåˆ°æ•°æ®æŸ¥è¯¢å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚</li></ul><h3 id="äºŒã€å…¨å±€å¼‚å¸¸å¤„ç†" tabindex="-1">äºŒã€å…¨å±€å¼‚å¸¸å¤„ç† <a class="header-anchor" href="#äºŒã€å…¨å±€å¼‚å¸¸å¤„ç†" aria-label="Permalink to &quot;äºŒã€å…¨å±€å¼‚å¸¸å¤„ç†&quot;">â€‹</a></h3><p>ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†çš„ä¼˜ç‚¹å°±æ˜¯æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥å¤„ç†æ¯”è¾ƒå¤æ‚çš„é€»è¾‘æ ¡éªŒï¼Œåœ¨æ ¡éªŒå¤±è´¥çš„æ—¶å€™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åè¿›è¡Œæ•è·å¤„ç†å°±å¯ä»¥äº†ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œæ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±» ApiExceptionã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">ApiException</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">extends</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">RuntimeException</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">IErrorCode</span><span style="color:#F6F6F4;"> errorCode;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ApiException</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">IErrorCode</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">errorCode</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#BF9EEE;font-style:italic;">super</span><span style="color:#F6F6F4;">(errorCode.</span><span style="color:#62E884;">getMessage</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#BF9EEE;font-style:italic;">this</span><span style="color:#F6F6F4;">.errorCode </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> errorCode;</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ApiException</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">message</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#BF9EEE;font-style:italic;">super</span><span style="color:#F6F6F4;">(message);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ApiException</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">Throwable</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">cause</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#BF9EEE;font-style:italic;">super</span><span style="color:#F6F6F4;">(cause);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ApiException</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">message</span><span style="color:#F6F6F4;">, </span><span style="color:#97E1F1;font-style:italic;">Throwable</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">cause</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#BF9EEE;font-style:italic;">super</span><span style="color:#F6F6F4;">(message, cause);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">IErrorCode</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">getErrorCode</span><span style="color:#F6F6F4;">() {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> errorCode;</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiException</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RuntimeException</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> IErrorCode errorCode;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiException</span><span style="color:#24292E;">(IErrorCode </span><span style="color:#E36209;">errorCode</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">(errorCode.</span><span style="color:#6F42C1;">getMessage</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.errorCode </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> errorCode;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiException</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">message</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">(message);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiException</span><span style="color:#24292E;">(Throwable </span><span style="color:#E36209;">cause</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">(cause);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiException</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">message</span><span style="color:#24292E;">, Throwable </span><span style="color:#E36209;">cause</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">(message, cause);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> IErrorCode </span><span style="color:#6F42C1;">getErrorCode</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> errorCode;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>ç¬¬äºŒæ­¥ï¼Œæ–°å»ºä¸€ä¸ªæ–­è¨€å¤„ç†ç±» Assertsï¼Œç®€åŒ–æŠ›å‡º ApiException çš„æ­¥éª¤ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">Asserts</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">fail</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">message</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">throw</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ApiException</span><span style="color:#F6F6F4;">(message);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">fail</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">IErrorCode</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">errorCode</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">throw</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ApiException</span><span style="color:#F6F6F4;">(errorCode);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Asserts</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fail</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">message</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiException</span><span style="color:#24292E;">(message);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fail</span><span style="color:#24292E;">(IErrorCode </span><span style="color:#E36209;">errorCode</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiException</span><span style="color:#24292E;">(errorCode);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>ç¬¬ä¸‰æ­¥ï¼Œæ–°å»ºä¸€å…¨å±€å¼‚å¸¸å¤„ç†ç±» GlobalExceptionHandlerï¼Œå¯¹å¼‚å¸¸ä¿¡æ¯è¿›è¡Œè§£æï¼Œå¹¶å°è£…åˆ°ç»Ÿä¸€çš„è¿”å›å¯¹è±¡ ResultObject ä¸­ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">ControllerAdvice</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">GlobalExceptionHandler</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ResponseBody</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ExceptionHandler</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> ApiException.class)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ResultObject</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">handle</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">ApiException</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">e</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (e.</span><span style="color:#62E884;">getErrorCode</span><span style="color:#F6F6F4;">() </span><span style="color:#F286C4;">!=</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">null</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> ResultObject.</span><span style="color:#62E884;">failed</span><span style="color:#F6F6F4;">(e.</span><span style="color:#62E884;">getErrorCode</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> ResultObject.</span><span style="color:#62E884;">failed</span><span style="color:#F6F6F4;">(e.</span><span style="color:#62E884;">getMessage</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ControllerAdvice</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GlobalExceptionHandler</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ResponseBody</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ExceptionHandler</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ApiException.class)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> ResultObject </span><span style="color:#6F42C1;">handle</span><span style="color:#24292E;">(ApiException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (e.</span><span style="color:#6F42C1;">getErrorCode</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ResultObject.</span><span style="color:#6F42C1;">failed</span><span style="color:#24292E;">(e.</span><span style="color:#6F42C1;">getErrorCode</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ResultObject.</span><span style="color:#6F42C1;">failed</span><span style="color:#24292E;">(e.</span><span style="color:#6F42C1;">getMessage</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>å…¨å±€å¼‚å¸¸å¤„ç†ç±»ç”¨åˆ°äº†ä¸¤ä¸ªæ³¨è§£ï¼Œ<code>@ControllerAdvice</code> å’Œ <code>@ExceptionHandler</code>ã€‚</p><p><code>@ControllerAdvice</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ <code>@Component</code>ï¼ˆå¯ä»¥é€šè¿‡æºç çœ‹å¾—åˆ°ï¼‰ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¸­è¢«ä»¥ä¸‹ä¸‰ç§æ³¨è§£æ ‡è¯†çš„æ–¹æ³•ï¼š<code>@ExceptionHandler</code>ï¼Œ<code>@InitBinder</code>ï¼Œ<code>@ModelAttribute</code>ï¼Œå°†ä½œç”¨äºæ‰€æœ‰<code>@Controller</code> ç±»çš„æ¥å£ä¸Šã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Target</span><span style="color:#F6F6F4;">({ElementType.TYPE})</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Retention</span><span style="color:#F6F6F4;">(RetentionPolicy.RUNTIME)</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Documented</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Component</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> @</span><span style="color:#F286C4;">interface</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ControllerAdvice</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Target</span><span style="color:#24292E;">({ElementType.TYPE})</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Retention</span><span style="color:#24292E;">(RetentionPolicy.RUNTIME)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Documented</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Component</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> @</span><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ControllerAdvice</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><code>@ExceptionHandler</code> æ³¨è§£çš„ä½œç”¨å°±æ˜¯æ ‡è¯†ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œå®ƒå¯ä»¥æŒ‡å®šè¦ç»Ÿä¸€å¤„ç†çš„å¼‚å¸¸ç±»å‹ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è‡ªå®šä¹‰çš„ ApiExceptionã€‚</p><p>ç¬¬å››æ­¥ï¼Œåœ¨éœ€è¦æ ¡éªŒçš„åœ°æ–¹é€šè¿‡ Asserts ç±»æŠ›å‡ºå¼‚å¸¸ ApiExceptionã€‚è¿˜æ‹¿ç”¨æˆ·ç™»å½•è¿™ä¸ªæ¥å£æ¥è¯´æ˜å§ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Controller</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Api</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">tags</span><span style="color:#F286C4;">=</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç”¨æˆ·</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">RequestMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">/users</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">UsersController</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ApiOperation</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ç™»å½•ä»¥åè¿”å›token</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">RequestMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">/login</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, </span><span style="color:#BF9EEE;">method</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> RequestMethod.POST)</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">ResponseBody</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ResultObject</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">login</span><span style="color:#F6F6F4;">(@</span><span style="color:#97E1F1;font-style:italic;">Validated</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">UsersLoginParam</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">users</span><span style="color:#F6F6F4;">, </span><span style="color:#97E1F1;font-style:italic;">BindingResult</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">result</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> token </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> usersService.</span><span style="color:#62E884;">login</span><span style="color:#F6F6F4;">(users.</span><span style="color:#62E884;">getUserLogin</span><span style="color:#F6F6F4;">(), users.</span><span style="color:#62E884;">getUserPass</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">     </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">Map</span><span style="color:#F6F6F4;">&lt;String, String&gt; tokenMap </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">HashMap</span><span style="color:#F6F6F4;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#F6F6F4;">        tokenMap.</span><span style="color:#62E884;">put</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">token</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, token);</span></span>
<span class="line"><span style="color:#F6F6F4;">        tokenMap.</span><span style="color:#62E884;">put</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">tokenHead</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, tokenHead);</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> ResultObject.</span><span style="color:#62E884;">success</span><span style="color:#F6F6F4;">(tokenMap);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Controller</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Api</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">tags</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;ç”¨æˆ·&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/users&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UsersController</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ApiOperation</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ç™»å½•ä»¥åè¿”å›token&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/login&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">method</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> RequestMethod.POST)</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">ResponseBody</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> ResultObject </span><span style="color:#6F42C1;">login</span><span style="color:#24292E;">(@</span><span style="color:#D73A49;">Validated</span><span style="color:#24292E;"> UsersLoginParam </span><span style="color:#E36209;">users</span><span style="color:#24292E;">, BindingResult </span><span style="color:#E36209;">result</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        String token </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> usersService.</span><span style="color:#6F42C1;">login</span><span style="color:#24292E;">(users.</span><span style="color:#6F42C1;">getUserLogin</span><span style="color:#24292E;">(), users.</span><span style="color:#6F42C1;">getUserPass</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">     </span></span>
<span class="line"><span style="color:#24292E;">        Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; tokenMap </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292E;">        tokenMap.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;token&quot;</span><span style="color:#24292E;">, token);</span></span>
<span class="line"><span style="color:#24292E;">        tokenMap.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;tokenHead&quot;</span><span style="color:#24292E;">, tokenHead);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> ResultObject.</span><span style="color:#6F42C1;">success</span><span style="color:#24292E;">(tokenMap);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>è¯¥æ¥å£éœ€è¦æŸ¥è¯¢æ•°æ®åº“éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœå¯†ç ä¸æ­£ç¡®å°±æŠ›å‡ºæ ¡éªŒä¿¡æ¯â€œå¯†ç ä¸æ­£ç¡®â€ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Service</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">UsersServiceImpl</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">extends</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ServiceImpl</span><span style="color:#F6F6F4;">&lt;UsersMapper, Users&gt; </span><span style="color:#F286C4;">implements</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">IUsersService</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">login</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">username</span><span style="color:#F6F6F4;">, </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">password</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> token </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">null</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">//å¯†ç éœ€è¦å®¢æˆ·ç«¯åŠ å¯†åä¼ é€’</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">UserDetails</span><span style="color:#F6F6F4;"> userDetails </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">loadUserByUsername</span><span style="color:#F6F6F4;">(username);</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (</span><span style="color:#F286C4;">!</span><span style="color:#F6F6F4;">passwordEncoder.</span><span style="color:#62E884;">matches</span><span style="color:#F6F6F4;">(password, userDetails.</span><span style="color:#62E884;">getPassword</span><span style="color:#F6F6F4;">())) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            Asserts.</span><span style="color:#62E884;">fail</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">å¯†ç ä¸æ­£ç¡®</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">         }</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// å…¶ä»–ä»£ç çœç•¥</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> token;</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Service</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UsersServiceImpl</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServiceImpl</span><span style="color:#24292E;">&lt;</span><span style="color:#D73A49;">UsersMapper</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">Users</span><span style="color:#24292E;">&gt; </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IUsersService</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">login</span><span style="color:#24292E;">(String </span><span style="color:#E36209;">username</span><span style="color:#24292E;">, String </span><span style="color:#E36209;">password</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        String token </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//å¯†ç éœ€è¦å®¢æˆ·ç«¯åŠ å¯†åä¼ é€’</span></span>
<span class="line"><span style="color:#24292E;">        UserDetails userDetails </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">loadUserByUsername</span><span style="color:#24292E;">(username);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">passwordEncoder.</span><span style="color:#6F42C1;">matches</span><span style="color:#24292E;">(password, userDetails.</span><span style="color:#6F42C1;">getPassword</span><span style="color:#24292E;">())) {</span></span>
<span class="line"><span style="color:#24292E;">            Asserts.</span><span style="color:#6F42C1;">fail</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;å¯†ç ä¸æ­£ç¡®&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// å…¶ä»–ä»£ç çœç•¥</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> token;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>ç¬¬äº”æ­¥ï¼Œé€šè¿‡ ApiPost æ¥æµ‹è¯•ä¸€ä¸‹æ¥å£ï¼Œæ•…æ„æŠŠå¯†ç è¾“é”™ã€‚</p><img src="`+r+'"><p>ä¹Ÿå¯ä»¥é€šè¿‡ debug çš„å½¢å¼ï¼Œä½“éªŒä¸€ä¸‹æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚</p><img src="'+y+'"><h3 id="ä¸‰ã€æ€»ç»“" tabindex="-1">ä¸‰ã€æ€»ç»“ <a class="header-anchor" href="#ä¸‰ã€æ€»ç»“" aria-label="Permalink to &quot;ä¸‰ã€æ€»ç»“&quot;">â€‹</a></h3><p>å®é™…å¼€å‘ä¸­æŠŠä¸¤è€…ç»“åˆåœ¨ä¸€èµ·ç”¨ï¼Œå°±å¯ä»¥å¼¥è¡¥å½¼æ­¤çš„çŸ­æ¿äº†ï¼Œç®€å•æ ¡éªŒç”¨ Hibernate Validatorï¼Œå¤æ‚ä¸€ç‚¹çš„é€»è¾‘æ ¡éªŒï¼Œæ¯”å¦‚è¯´éœ€è¦æ•°æ®åº“æŸ¥è¯¢ç”¨å…¨å±€å¼‚å¸¸å¤„ç†æ¥å®ç°ã€‚</p><p>ä¸ºäº†æŠŠ Spring Boot é€»è¾‘æ ¡éªŒè¿™å—å•ç‹¬æ‹‰å‡ºæ¥åšä¸€ä¸ª demo çš„ä¾‹å­ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ª codingmore-validator çš„é¡¹ç›®ï¼Œæ”¾åœ¨ codingmore-learning é¡¹ç›®ä¸‹é¢äº†ï¼Œæƒ³è¦å‚è€ƒçš„ï¼Œç›´æ¥æˆ³ä¸‹é¢çš„ä¸¤ä¸ªé“¾æ¥ã€‚</p><p>å®Œæ•´çš„ç¼–ç¨‹å–µæ•´ä¸ªé¡¹ç›®çš„æºç æˆ³ç¬¬ä¸€ä¸ªï¼Œåªæƒ³çœ‹é€»è¾‘æ ¡éªŒçš„æˆ³ç¬¬äºŒä¸ªã€‚</p><blockquote><ul><li>ç¼–ç¨‹å–µğŸ±æºç åœ°å€ï¼š<a href="https://github.com/itwanger/coding-more" target="_blank" rel="noreferrer">https://github.com/itwanger/coding-more</a></li><li>codingmore-validator: <a href="https://github.com/itwanger/codingmore-learning/tree/main/codingmore-validator" target="_blank" rel="noreferrer">https://github.com/itwanger/codingmore-learning/tree/main/codingmore-validator</a></li></ul></blockquote><img src="'+F+'"><p>æ¯ä¸ªç±»ï¼Œæ¯ä¸ªæ–¹æ³•åŸºæœ¬ä¸Šéƒ½åŠ äº†æ³¨é‡Šï¼Œå¯ä»¥å¾ˆå®¹æ˜“å°±çœ‹å¾—æ‡‚ã€‚</p>',60),d=[E];function u(g,C,f,A,D,b){return n(),a("div",null,d)}const m=s(i,[["render",u]]);export{h as __pageData,m as default};

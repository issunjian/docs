import{_ as s,o as a,c as n,V as l}from"./chunks/framework.c6d8cbec.js";const E=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"backend/spring/SpringCloud02.md","filePath":"backend/spring/SpringCloud02.md"}'),p={name:"backend/spring/SpringCloud02.md"},o=l(`<h2 id="springcloudå®ç”¨ç¯‡02" tabindex="-1">SpringCloudå®ç”¨ç¯‡02 <a class="header-anchor" href="#springcloudå®ç”¨ç¯‡02" aria-label="Permalink to &quot;SpringCloudå®ç”¨ç¯‡02&quot;">â€‹</a></h2><h2 id="_1-nacosé…ç½®ç®¡ç†" tabindex="-1">1.Nacosé…ç½®ç®¡ç† <a class="header-anchor" href="#_1-nacosé…ç½®ç®¡ç†" aria-label="Permalink to &quot;1.Nacosé…ç½®ç®¡ç†&quot;">â€‹</a></h2><p>Nacosé™¤äº†å¯ä»¥åšæ³¨å†Œä¸­å¿ƒï¼ŒåŒæ ·å¯ä»¥åšé…ç½®ç®¡ç†æ¥ä½¿ç”¨ã€‚</p><p><img src="http://image.yangeit.cn/i/2023/05/12/springcloud_02_jishus.jpg" alt="å¾®æœåŠ¡æŠ€æœ¯"></p><p>å¾®æœåŠ¡æŠ€æœ¯</p><h3 id="_1-1-ç»Ÿä¸€é…ç½®ç®¡ç†" tabindex="-1">1.1.ç»Ÿä¸€é…ç½®ç®¡ç† <a class="header-anchor" href="#_1-1-ç»Ÿä¸€é…ç½®ç®¡ç†" aria-label="Permalink to &quot;1.1.ç»Ÿä¸€é…ç½®ç®¡ç†&quot;">â€‹</a></h3><p>ç»Ÿä¸€é…ç½®ç®¡ç†</p><p>å½“<strong>å¾®æœåŠ¡éƒ¨ç½²çš„å®ä¾‹è¶Šæ¥è¶Šå¤š</strong>ï¼Œè¾¾åˆ°æ•°åã€æ•°ç™¾æ—¶ï¼Œé€ä¸ªä¿®æ”¹å¾®æœåŠ¡é…ç½®å°±ä¼šè®©äººæŠ“ç‹‚ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§<strong>ç»Ÿä¸€é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œå¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰å®ä¾‹çš„é…ç½®</strong>ğŸ¯ã€‚</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714164426792.png" alt="image-20210714164426792"></p><p>image-20210714164426792</p><p>**Nacosä½œä¸ºé…ç½®ä¸­å¿ƒçš„ç‰¹ç‚¹ï¼š**ğŸ‘‡</p><ul><li>ä¸€æ–¹é¢å¯ä»¥å°†é…ç½®é›†ä¸­ç®¡ç†ï¼Œ</li><li>å¦ä¸€æ–¹å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶ï¼ŒåŠæ—¶é€šçŸ¥å¾®æœåŠ¡ï¼Œå®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚</li></ul><p>**ä»£ç æ“ä½œæ­¥éª¤ï¼š**ğŸ‘‡</p><ol><li>åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶</li><li>ä»å¾®æœåŠ¡æ‹‰å–é…ç½® <ul><li>å¼•å…¥nacos-configä¾èµ–</li><li>æ·»åŠ bootstrap.yaml</li><li>è¯»å–nacosé…ç½®</li></ul></li><li>æµ‹è¯•</li></ol><h4 id="åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶" tabindex="-1">åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶ <a class="header-anchor" href="#åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶" aria-label="Permalink to &quot;åœ¨nacosä¸­æ·»åŠ é…ç½®æ–‡ä»¶&quot;">â€‹</a></h4><p>å¦‚ä½•åœ¨nacosä¸­ç®¡ç†é…ç½®å‘¢ï¼Ÿ</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714164742924.png" alt="image-20210714164742924"></p><p>image-20210714164742924</p><p>ç„¶ååœ¨å¼¹å‡ºçš„è¡¨å•ä¸­ï¼Œå¡«å†™é…ç½®ä¿¡æ¯ï¼š</p><p>DataIDï¼šæœåŠ¡åç§°-ç¯å¢ƒå.yaml</p><p>Group:é»˜è®¤å³å¯</p><p>é…ç½®æ ¼å¼ï¼šYaml</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714164856664.png" alt="image-20210714164856664"></p><p>image-20210714164856664</p><blockquote><p>æ³¨æ„ï¼š<strong>é¡¹ç›®çš„æ ¸å¿ƒé…ç½®ï¼Œéœ€è¦çƒ­æ›´æ–°çš„é…ç½®æ‰æœ‰æ”¾åˆ°nacosç®¡ç†çš„å¿…è¦</strong>æ³¨æ„ã€‚åŸºæœ¬ä¸ä¼šå˜æ›´çš„ä¸€äº›é…ç½®è¿˜æ˜¯ä¿å­˜åœ¨å¾®æœåŠ¡æœ¬åœ°æ¯”è¾ƒå¥½å¦‚ï¼šæ•°æ®åº“ä¿¡æ¯ã€‚</p></blockquote><h4 id="ä»å¾®æœåŠ¡æ‹‰å–é…ç½®" tabindex="-1">ä»å¾®æœåŠ¡æ‹‰å–é…ç½® <a class="header-anchor" href="#ä»å¾®æœåŠ¡æ‹‰å–é…ç½®" aria-label="Permalink to &quot;ä»å¾®æœåŠ¡æ‹‰å–é…ç½®&quot;">â€‹</a></h4><p><strong>å¾®æœåŠ¡è¦æ‹‰å–nacosä¸­ç®¡ç†çš„é…ç½®ï¼Œå¹¶ä¸”ä¸æœ¬åœ°çš„application.ymlé…ç½®åˆå¹¶ï¼Œæ‰èƒ½å®Œæˆé¡¹ç›®å¯åŠ¨ã€‚</strong></p><ol><li>å¦‚æœå°šæœªè¯»å–application.ymlï¼Œæ— æ³•å¾—çŸ¥nacosåœ°å€ï¼Œè¿›è€Œæ— æ³•è¿æ¥é…ç½®ä¸­å¿ƒ <ul><li>å› æ­¤springå¼•å…¥äº†ä¸€ç§æ–°çš„é…ç½®æ–‡ä»¶ï¼š<code>bootstrap.yaml/ymlæ–‡ä»¶</code>ï¼Œä¼šåœ¨<code>application.yml</code>ä¹‹å‰è¢«è¯»å–ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</li></ul></li></ol><p><img src="http://image.yangeit.cn/i/2023/05/11/L0iFYNF.png" alt="img"></p><p>img</p><h5 id="_1ï¸âƒ£-å¼•å…¥nacos-configä¾èµ–" tabindex="-1">1ï¸âƒ£ å¼•å…¥nacos-configä¾èµ– <a class="header-anchor" href="#_1ï¸âƒ£-å¼•å…¥nacos-configä¾èµ–" aria-label="Permalink to &quot;1ï¸âƒ£ å¼•å…¥nacos-configä¾èµ–&quot;">â€‹</a></h5><p>é¦–å…ˆï¼Œåœ¨<code>user-serviceæœåŠ¡</code>ä¸­ï¼Œå¼•å…¥nacos-configçš„å®¢æˆ·ç«¯ä¾èµ–ï¼š</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;spring-cloud-starter-alibaba-nacos-config&lt;/</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;/</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-alibaba-nacos-config&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><h5 id="_2ï¸âƒ£-æ·»åŠ bootstrap-yaml" tabindex="-1">2ï¸âƒ£ æ·»åŠ bootstrap.yaml <a class="header-anchor" href="#_2ï¸âƒ£-æ·»åŠ bootstrap-yaml" aria-label="Permalink to &quot;2ï¸âƒ£ æ·»åŠ bootstrap.yaml&quot;">â€‹</a></h5><p>ç„¶åï¼Œåœ¨<code>user-service</code>ä¸­æ·»åŠ ä¸€ä¸ª<code>bootstrap.yaml</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">spring</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">application</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">name</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">userservice</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æœåŠ¡åç§°</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">profiles</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">active</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">dev</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev </span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">cloud</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">nacos</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">server-addr</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">localhost:8848</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># Nacosåœ°å€</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">config</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">file-extension</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">yaml</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æ–‡ä»¶åç¼€å</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">application</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">userservice</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æœåŠ¡åç§°</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">profiles</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">active</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cloud</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nacos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">server-addr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localhost:8848</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Nacosåœ°å€</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">config</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">file-extension</span><span style="color:#24292E;">: </span><span style="color:#032F62;">yaml</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æ–‡ä»¶åç¼€å</span></span></code></pre></div><p>è¿™é‡Œä¼šæ ¹æ®spring.cloud.nacos.server-addrè·å–nacosåœ°å€ï¼Œå†æ ¹æ®</p><p><code>\${spring.application.name}-\${spring.profiles.active}.\${spring.cloud.nacos.config.file-extension}</code>ä½œä¸ºæ–‡ä»¶idï¼Œæ¥è¯»å–é…ç½®ã€‚</p><p>æœ¬ä¾‹ä¸­ï¼Œå°±æ˜¯å»è¯»å–<code>userservice-dev.yaml</code>ï¼š ğŸ‘‡</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714170845901.png" alt="image-20210714170845901"></p><p>image-20210714170845901</p><h5 id="_3ï¸âƒ£-è¯»å–nacosé…ç½®" tabindex="-1">3ï¸âƒ£ è¯»å–nacosé…ç½® <a class="header-anchor" href="#_3ï¸âƒ£-è¯»å–nacosé…ç½®" aria-label="Permalink to &quot;3ï¸âƒ£ è¯»å–nacosé…ç½®&quot;">â€‹</a></h5><p>åœ¨<code>user-service</code>ä¸­çš„<code>UserController</code>ä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘ï¼Œè¯»å–<code>pattern.dateformaté…ç½®</code>ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714170337448.png" alt="image-20210714170337448"></p><p>image-20210714170337448</p><p>å®Œæ•´ä»£ç ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Slf4j</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">RestController</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">RequestMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">/user</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">UserController</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Autowired</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">UserService</span><span style="color:#F6F6F4;"> userService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Value</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">\${pattern.dateformat}</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> dateformat;</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">GetMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">now</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">now</span><span style="color:#F6F6F4;">(){</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> LocalDateTime.</span><span style="color:#62E884;">now</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">format</span><span style="color:#F6F6F4;">(DateTimeFormatter.</span><span style="color:#62E884;">ofPattern</span><span style="color:#F6F6F4;">(dateformat));</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ...ç•¥</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Slf4j</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RestController</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/user&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserController</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> UserService userService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Value</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;\${pattern.dateformat}&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String dateformat;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GetMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;now&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">now</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> LocalDateTime.</span><span style="color:#6F42C1;">now</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">format</span><span style="color:#24292E;">(DateTimeFormatter.</span><span style="color:#6F42C1;">ofPattern</span><span style="color:#24292E;">(dateformat));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ...ç•¥</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>å¯åŠ¨å„ä¸ªæœåŠ¡ï¼Œåœ¨é¡µé¢è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714170449612.png" alt="image-20210714170449612"></p><p>image-20210714170449612</p><h3 id="_1-2-é…ç½®çƒ­æ›´æ–°" tabindex="-1">1.2.é…ç½®çƒ­æ›´æ–° <a class="header-anchor" href="#_1-2-é…ç½®çƒ­æ›´æ–°" aria-label="Permalink to &quot;1.2.é…ç½®çƒ­æ›´æ–°&quot;">â€‹</a></h3><p>å‰è¨€</p><p>æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ï¼Œæ˜¯ä¿®æ”¹nacosä¸­çš„é…ç½®åï¼Œå¾®æœåŠ¡ä¸­æ— éœ€é‡å¯å³å¯è®©é…ç½®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯<strong>é…ç½®çƒ­æ›´æ–°</strong>ã€‚</p><p>è¦å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p><h4 id="_1-2-1-æ–¹å¼ä¸€" tabindex="-1">1.2.1.æ–¹å¼ä¸€ <a class="header-anchor" href="#_1-2-1-æ–¹å¼ä¸€" aria-label="Permalink to &quot;1.2.1.æ–¹å¼ä¸€&quot;">â€‹</a></h4><p>åœ¨<code>@Value</code>æ³¨å…¥çš„å˜é‡æ‰€åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£<code>@RefreshScope</code>ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714171036335.png" alt="image-20210714171036335"></p><p>image-20210714171036335</p><h4 id="_1-2-2-æ–¹å¼äºŒ" tabindex="-1">1.2.2.æ–¹å¼äºŒ <a class="header-anchor" href="#_1-2-2-æ–¹å¼äºŒ" aria-label="Permalink to &quot;1.2.2.æ–¹å¼äºŒ&quot;">â€‹</a></h4><p>ä½¿ç”¨<code>@ConfigurationProperties</code>æ³¨è§£ä»£æ›¿<code>@Value</code>æ³¨è§£ã€‚</p><p>åœ¨user-serviceæœåŠ¡ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç±»ï¼Œè¯»å–patterrn.dateformatå±æ€§ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Component</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Data</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">ConfigurationProperties</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">prefix</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">pattern</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">PatternProperties</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> dateformat;</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Component</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">ConfigurationProperties</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">prefix</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pattern&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PatternProperties</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String dateformat;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>åœ¨UserControllerä¸­ä½¿ç”¨è¿™ä¸ªç±»ä»£æ›¿@Valueï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714171316124.png" alt="image-20210714171316124"></p><p>image-20210714171316124</p><p><strong>å®Œæ•´ä»£ç ï¼š</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Slf4j</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">RestController</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">RequestMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">/user</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">UserController</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Autowired</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">UserService</span><span style="color:#F6F6F4;"> userService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Autowired</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">PatternProperties</span><span style="color:#F6F6F4;"> patternProperties;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">GetMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">now</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">now</span><span style="color:#F6F6F4;">(){</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> LocalDateTime.</span><span style="color:#62E884;">now</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">format</span><span style="color:#F6F6F4;">(DateTimeFormatter.</span><span style="color:#62E884;">ofPattern</span><span style="color:#F6F6F4;">(patternProperties.</span><span style="color:#62E884;">getDateformat</span><span style="color:#F6F6F4;">()));</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ç•¥</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Slf4j</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RestController</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RequestMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/user&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserController</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> UserService userService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Autowired</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> PatternProperties patternProperties;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GetMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;now&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">now</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> LocalDateTime.</span><span style="color:#6F42C1;">now</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">format</span><span style="color:#24292E;">(DateTimeFormatter.</span><span style="color:#6F42C1;">ofPattern</span><span style="color:#24292E;">(patternProperties.</span><span style="color:#6F42C1;">getDateformat</span><span style="color:#24292E;">()));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ç•¥</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="_1-3-é…ç½®å…±äº«" tabindex="-1">1.3.é…ç½®å…±äº« <a class="header-anchor" href="#_1-3-é…ç½®å…±äº«" aria-label="Permalink to &quot;1.3.é…ç½®å…±äº«&quot;">â€‹</a></h3><p>å‰è¨€</p><p>å…¶å®<strong>å¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå»nacosè¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶</strong>ï¼Œä¾‹å¦‚ï¼š</p><ul><li><p><code>[spring.application.name]-[spring.profiles.active].yaml</code>å¦‚ï¼šuserservice-dev.yaml</p></li><li><p><code>[spring.application.name].yaml</code>å¦‚ï¼šuserservice.yaml</p></li></ul><p>è€Œ<code>[spring.application.name].yaml</code>ä¸åŒ…å«ç¯å¢ƒå¦‚ï¼šuserservice.yamlï¼Œ<strong>å› æ­¤å¯ä»¥è¢«å¤šä¸ªç¯å¢ƒå…±äº«</strong>ã€‚</p><p><img src="http://image.yangeit.cn/i/2023/05/12/springcloud_02_mooreconifg.png" alt=""></p><p><strong>é…ç½®å…±äº«çš„ä¼˜å…ˆçº§</strong> ğŸ‘‡</p><p>å½“nacosã€æœåŠ¡æœ¬åœ°åŒæ—¶å‡ºç°ç›¸åŒå±æ€§æ—¶ï¼Œä¼˜å…ˆçº§æœ‰é«˜ä½ä¹‹åˆ†ï¼š <img src="http://image.yangeit.cn/i/2023/05/11/image-20210714174623557.png" alt="image-20210714174623557"></p><p>**æ¡ˆä¾‹ä»£ç éªŒè¯æ“ä½œï¼š**ğŸ‘‡ğŸ‘‡</p><h4 id="_1-æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®" tabindex="-1">1ï¼‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½® <a class="header-anchor" href="#_1-æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®" aria-label="Permalink to &quot;1ï¼‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå…±äº«é…ç½®&quot;">â€‹</a></h4><p>æˆ‘ä»¬åœ¨nacosä¸­æ·»åŠ ä¸€ä¸ª<code>userservice.yamlæ–‡ä»¶</code>ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714173233650.png" alt="image-20210714173233650"></p><p>image-20210714173233650</p><h4 id="_2-åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®" tabindex="-1">2ï¼‰åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½® <a class="header-anchor" href="#_2-åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®" aria-label="Permalink to &quot;2ï¼‰åœ¨user-serviceä¸­è¯»å–å…±äº«é…ç½®&quot;">â€‹</a></h4><p>åœ¨<code>user-serviceæœåŠ¡ä¸­</code>ï¼Œä¿®æ”¹<code>PatternPropertiesç±»</code>ï¼Œè¯»å–æ–°æ·»åŠ çš„å±æ€§ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714173324231.png" alt="image-20210714173324231"></p><p>image-20210714173324231</p><p>åœ¨<code>user-serviceæœåŠ¡</code>ä¸­ï¼Œä¿®æ”¹<code>UserController</code>ï¼Œæ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714173721309.png" alt="image-20210714173721309"></p><p>image-20210714173721309</p><h4 id="_3-è¿è¡Œä¸¤ä¸ªuserapplication-ä½¿ç”¨ä¸åŒçš„profile" tabindex="-1">3ï¼‰è¿è¡Œä¸¤ä¸ªUserApplicationï¼Œä½¿ç”¨ä¸åŒçš„profile <a class="header-anchor" href="#_3-è¿è¡Œä¸¤ä¸ªuserapplication-ä½¿ç”¨ä¸åŒçš„profile" aria-label="Permalink to &quot;3ï¼‰è¿è¡Œä¸¤ä¸ªUserApplicationï¼Œä½¿ç”¨ä¸åŒçš„profile&quot;">â€‹</a></h4><p><code>ä¿®æ”¹UserApplication2è¿™ä¸ªå¯åŠ¨é¡¹ï¼Œæ”¹å˜å…¶profileå€¼</code>ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714173538538.png" alt="image-20210714173538538"></p><p>image-20210714173538538</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714173519963.png" alt="image-20210714173519963"></p><p>image-20210714173519963</p><p><strong>UserApplication(8081)ä½¿ç”¨çš„profileæ˜¯devï¼ŒUserApplication2(8082)ä½¿ç”¨çš„profileæ˜¯test</strong>ã€‚ğŸ‘ˆ</p><p>å¯åŠ¨UserApplicationå’ŒUserApplication2</p><p>è®¿é—®<a href="http://localhost:8081/user/prop%EF%BC%8C%E7%BB%93%E6%9E%9C%EF%BC%9A" target="_blank" rel="noreferrer">http://localhost:8081/user/propï¼Œç»“æœï¼šopen in new window</a></p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714174313344.png" alt="image-20210714174313344"></p><p>image-20210714174313344</p><p>è®¿é—®<code>http://localhost:8082/user/prop</code>ï¼Œç»“æœï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714174424818.png" alt="image-20210714174424818"></p><p>image-20210714174424818</p><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸ç®¡æ˜¯devï¼Œè¿˜æ˜¯testç¯å¢ƒï¼Œéƒ½è¯»å–åˆ°äº†envSharedValueè¿™ä¸ªå±æ€§çš„å€¼ã€‚</p><h3 id="_1-4-æ­å»ºnacosé›†ç¾¤" tabindex="-1">1.4.æ­å»ºNacosé›†ç¾¤ <a class="header-anchor" href="#_1-4-æ­å»ºnacosé›†ç¾¤" aria-label="Permalink to &quot;1.4.æ­å»ºNacosé›†ç¾¤&quot;">â€‹</a></h3><p>æ­å»ºNacosé›†ç¾¤</p><p>Nacosç”Ÿäº§ç¯å¢ƒä¸‹<strong>ä¸€å®šè¦éƒ¨ç½²ä¸ºé›†ç¾¤çŠ¶æ€</strong>é«˜å¯ç”¨è¦æ±‚ï¼Œéƒ¨ç½²æ–¹å¼å‚è€ƒè¯¾å‰èµ„æ–™ä¸­çš„æ–‡æ¡£ä¸‹å›¾å¯ç‚¹å‡»ï¼š</p><p><a href="http://www.yangeit.cn:21010/springcloud2023/nacosColonyIinstall.html" target="_blank" rel="noreferrer"><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714174728042.png" alt="image-20210714174728042"></a></p><p>image-20210714174728042</p><h2 id="_2-feignè¿œç¨‹è°ƒç”¨" tabindex="-1">2.Feignè¿œç¨‹è°ƒç”¨ <a class="header-anchor" href="#_2-feignè¿œç¨‹è°ƒç”¨" aria-label="Permalink to &quot;2.Feignè¿œç¨‹è°ƒç”¨&quot;">â€‹</a></h2><h3 id="_2-1-feignæ›¿ä»£resttemplate" tabindex="-1">2.1.Feignæ›¿ä»£RestTemplate <a class="header-anchor" href="#_2-1-feignæ›¿ä»£resttemplate" aria-label="Permalink to &quot;2.1.Feignæ›¿ä»£RestTemplate&quot;">â€‹</a></h3><p>å‰è¨€</p><p>ä½¿ç”¨Feignçš„æ­¥éª¤ï¼š</p><ul><li>â‘  å¼•å…¥ä¾èµ–</li><li>â‘¡ æ·»åŠ @EnableFeignClientsæ³¨è§£</li><li>â‘¢ ç¼–å†™FeignClientæ¥å£</li><li>â‘£ ä½¿ç”¨FeignClientä¸­å®šä¹‰çš„æ–¹æ³•ä»£æ›¿RestTemplate</li></ul><h4 id="_1-å¼•å…¥ä¾èµ–" tabindex="-1">1ï¼‰å¼•å…¥ä¾èµ– <a class="header-anchor" href="#_1-å¼•å…¥ä¾èµ–" aria-label="Permalink to &quot;1ï¼‰å¼•å…¥ä¾èµ–&quot;">â€‹</a></h4><p>æˆ‘ä»¬åœ¨order-serviceæœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥feignçš„ä¾èµ–ï¼š</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">&lt;</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;org.springframework.cloud&lt;/</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;spring-cloud-starter-openfeign&lt;/</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;/</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.springframework.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-openfeign&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><h4 id="_2-æ·»åŠ æ³¨è§£" tabindex="-1">2ï¼‰æ·»åŠ æ³¨è§£ <a class="header-anchor" href="#_2-æ·»åŠ æ³¨è§£" aria-label="Permalink to &quot;2ï¼‰æ·»åŠ æ³¨è§£&quot;">â€‹</a></h4><p>åœ¨order-serviceçš„å¯åŠ¨ç±»æ·»åŠ <code>æ³¨è§£å¼€å¯Feign</code>çš„åŠŸèƒ½ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714175102524.png" alt="image-20210714175102524"></p><p>image-20210714175102524</p><h4 id="_3-ç¼–å†™feignçš„å®¢æˆ·ç«¯" tabindex="-1">3ï¼‰ç¼–å†™Feignçš„å®¢æˆ·ç«¯ <a class="header-anchor" href="#_3-ç¼–å†™feignçš„å®¢æˆ·ç«¯" aria-label="Permalink to &quot;3ï¼‰ç¼–å†™Feignçš„å®¢æˆ·ç«¯&quot;">â€‹</a></h4><p>åœ¨<code>order-serviceä¸­</code>æ–°å»ºä¸€ä¸ªæ¥å£ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">package</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">cn.itcast.order.client</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">FeignClient</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">userservice</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">interface</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">UserClient</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">GetMapping</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">/user/{id}</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">User</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">findById</span><span style="color:#F6F6F4;">(@</span><span style="color:#97E1F1;font-style:italic;">PathVariable</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">id</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">) </span><span style="color:#97E1F1;font-style:italic;">Long</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">id</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> cn.itcast.order.client;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">FeignClient</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;userservice&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserClient</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">GetMapping</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/user/{id}&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    User </span><span style="color:#6F42C1;">findById</span><span style="color:#24292E;">(@</span><span style="color:#D73A49;">PathVariable</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;id&quot;</span><span style="color:#24292E;">) Long </span><span style="color:#E36209;">id</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>è¿™ä¸ªå®¢æˆ·ç«¯ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><ul><li>æœåŠ¡åç§°ï¼šuserservice</li><li>è¯·æ±‚æ–¹å¼ï¼šGET</li><li>è¯·æ±‚è·¯å¾„ï¼š/user/</li><li>è¯·æ±‚å‚æ•°ï¼šLong id</li><li>è¿”å›å€¼ç±»å‹ï¼šUser</li></ul><p>è¿™æ ·ï¼ŒFeignå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘é€httpè¯·æ±‚ï¼Œæ— éœ€è‡ªå·±ä½¿ç”¨RestTemplateæ¥å‘é€äº†ã€‚</p><h4 id="_4-æµ‹è¯•" tabindex="-1">4ï¼‰æµ‹è¯• <a class="header-anchor" href="#_4-æµ‹è¯•" aria-label="Permalink to &quot;4ï¼‰æµ‹è¯•&quot;">â€‹</a></h4><p>ä¿®æ”¹order-serviceä¸­çš„OrderServiceç±»ä¸­çš„queryOrderByIdæ–¹æ³•ï¼Œä½¿ç”¨Feignå®¢æˆ·ç«¯ä»£æ›¿RestTemplateï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714175415087.png" alt="image-20210714175415087"></p><p>image-20210714175415087</p><p>æ˜¯ä¸æ˜¯çœ‹èµ·æ¥ä¼˜é›…å¤šäº†ã€‚</p><h3 id="_2-2-è‡ªå®šä¹‰é…ç½®" tabindex="-1">2.2.è‡ªå®šä¹‰é…ç½® <a class="header-anchor" href="#_2-2-è‡ªå®šä¹‰é…ç½®" aria-label="Permalink to &quot;2.2.è‡ªå®šä¹‰é…ç½®&quot;">â€‹</a></h3><p>è‡ªå®šä¹‰é…ç½®</p><p>Feignå¯ä»¥æ”¯æŒå¾ˆå¤šçš„è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>ç±»å‹</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>feign.Logger.Level</strong> â˜ï¸</td><td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td><td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td></tr><tr><td>feign.codec.Decoder</td><td>å“åº”ç»“æœçš„è§£æå™¨</td><td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td></tr><tr><td>feign.codec.Encoder</td><td>è¯·æ±‚å‚æ•°ç¼–ç </td><td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td></tr><tr><td>feign. Contract</td><td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td><td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td></tr><tr><td>feign. Retryer</td><td>å¤±è´¥é‡è¯•æœºåˆ¶</td><td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td></tr></tbody></table><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼å°±èƒ½æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨ ï¼Œå¦‚æœè¦è‡ªå®šä¹‰æ—¶ï¼Œåªéœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„<code>@Beanè¦†ç›–é»˜è®¤Bean</code>å³å¯ã€‚</p><p>**ä»£ç æ“ä½œï¼ˆæ—¥å¿—ä¾‹å­æ¥æ¼”ç¤ºå¦‚ä½•è‡ªå®šä¹‰é…ç½®ï¼‰ï¼š**ğŸ‘‡</p><h4 id="_2-2-1-é…ç½®æ–‡ä»¶æ–¹å¼" tabindex="-1">2.2.1.é…ç½®æ–‡ä»¶æ–¹å¼ <a class="header-anchor" href="#_2-2-1-é…ç½®æ–‡ä»¶æ–¹å¼" aria-label="Permalink to &quot;2.2.1.é…ç½®æ–‡ä»¶æ–¹å¼&quot;">â€‹</a></h4><p>åŸºäº<strong>é…ç½®æ–‡ä»¶</strong>ä¿®æ”¹<strong>feignçš„æ—¥å¿—çº§åˆ«</strong>å¯ä»¥<strong>é’ˆå¯¹å•ä¸ªæœåŠ¡</strong>ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">feign</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;">  </span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">client</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">config</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">userservice</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">loggerLevel</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">FULL</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;">#  æ—¥å¿—çº§åˆ«</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">feign</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">client</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">config</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">userservice</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">loggerLevel</span><span style="color:#24292E;">: </span><span style="color:#032F62;">FULL</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#  æ—¥å¿—çº§åˆ«</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥<strong>é’ˆå¯¹æ‰€æœ‰æœåŠ¡</strong>ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">feign</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;">  </span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">client</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">config</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">default</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">loggerLevel</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">FULL</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;">#  æ—¥å¿—çº§åˆ«</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">feign</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">client</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">config</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">default</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">loggerLevel</span><span style="color:#24292E;">: </span><span style="color:#032F62;">FULL</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#  æ—¥å¿—çº§åˆ«</span></span></code></pre></div><p>è€Œæ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š</p><ul><li><strong>NONEï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</strong></li><li>BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</li><li>HEADERSï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li>FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</li></ul><h4 id="_2-2-2-javaä»£ç æ–¹å¼" tabindex="-1">2.2.2.Javaä»£ç æ–¹å¼ <a class="header-anchor" href="#_2-2-2-javaä»£ç æ–¹å¼" aria-label="Permalink to &quot;2.2.2.Javaä»£ç æ–¹å¼&quot;">â€‹</a></h4><p>ä¹Ÿå¯ä»¥åŸºäºJavaä»£ç æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œ<strong>å…ˆå£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå£°æ˜ä¸€ä¸ªLogger.Levelçš„å¯¹è±¡</strong>ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">DefaultFeignConfiguration</span><span style="color:#F6F6F4;">  {</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Bean</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Logger</span><span style="color:#F6F6F4;">.</span><span style="color:#97E1F1;font-style:italic;">Level</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">feignLogLevel</span><span style="color:#F6F6F4;">(){</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> Logger.Level.BASIC; </span><span style="color:#7B7F8B;">// æ—¥å¿—çº§åˆ«ä¸ºBASIC</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DefaultFeignConfiguration</span><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Bean</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Logger.Level </span><span style="color:#6F42C1;">feignLogLevel</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> Logger.Level.BASIC; </span><span style="color:#6A737D;">// æ—¥å¿—çº§åˆ«ä¸ºBASIC</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>å¦‚æœè¦<strong>å…¨å±€ç”Ÿæ•ˆ</strong>ï¼Œå°†å…¶æ”¾åˆ°å¯åŠ¨ç±»çš„<code>@EnableFeignClients</code>è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">EnableFeignClients</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">defaultConfiguration</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> DefaultFeignConfiguration .class)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">EnableFeignClients</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">defaultConfiguration</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> DefaultFeignConfiguration .class)</span></span></code></pre></div><p>å¦‚æœæ˜¯<strong>å±€éƒ¨ç”Ÿæ•ˆ</strong>ï¼Œåˆ™æŠŠå®ƒæ”¾åˆ°å¯¹åº”çš„<code>@FeignClient</code>è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">FeignClient</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">value</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">userservice</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, </span><span style="color:#BF9EEE;">configuration</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> DefaultFeignConfiguration .class)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">FeignClient</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;userservice&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">configuration</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> DefaultFeignConfiguration .class)</span></span></code></pre></div><h3 id="_2-3-feignä½¿ç”¨ä¼˜åŒ–" tabindex="-1">2.3.Feignä½¿ç”¨ä¼˜åŒ– <a class="header-anchor" href="#_2-3-feignä½¿ç”¨ä¼˜åŒ–" aria-label="Permalink to &quot;2.3.Feignä½¿ç”¨ä¼˜åŒ–&quot;">â€‹</a></h3><p>å‰è¨€</p><p>Feignåº•å±‚å‘èµ·<strong>httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶</strong>ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p><ul><li>URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </li><li>Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </li><li>OKHttpï¼šæ”¯æŒè¿æ¥æ± </li></ul><p>å› æ­¤æé«˜Feignçš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨<strong>è¿æ¥æ± </strong>ä»£æ›¿é»˜è®¤çš„URLConnection ğŸ¯</p><p><strong>è¿™é‡Œæˆ‘ä»¬ç”¨Apacheçš„HttpClientæ¥æ¼”ç¤ºï¼š</strong> ğŸ‘‡ ğŸ‘‡</p><p>1ï¼‰å¼•å…¥ä¾èµ–</p><p>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­å¼•å…¥Apacheçš„HttpClientä¾èµ–ï¼š</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">&lt;!--httpClientçš„ä¾èµ– --&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;io.github.openfeign&lt;/</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;feign-httpclient&lt;/</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;/</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!--httpClientçš„ä¾èµ– --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;io.github.openfeign&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;feign-httpclient&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>2ï¼‰é…ç½®è¿æ¥æ± </p><p>åœ¨order-serviceçš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">feign</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">client</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">config</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">default</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># defaultå…¨å±€çš„é…ç½®</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">loggerLevel</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">BASIC</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æ—¥å¿—çº§åˆ«ï¼ŒBASICå°±æ˜¯åŸºæœ¬çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">httpclient</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">enabled</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">true</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">max-connections</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">200</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æœ€å¤§çš„è¿æ¥æ•°</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">max-connections-per-route</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">50</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">feign</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">client</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">config</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">default</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># defaultå…¨å±€çš„é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">loggerLevel</span><span style="color:#24292E;">: </span><span style="color:#032F62;">BASIC</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æ—¥å¿—çº§åˆ«ï¼ŒBASICå°±æ˜¯åŸºæœ¬çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">httpclient</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max-connections</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">200</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æœ€å¤§çš„è¿æ¥æ•°</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max-connections-per-route</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">50</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨FeignClientFactoryBeanä¸­çš„loadBalanceæ–¹æ³•ä¸­æ‰“æ–­ç‚¹ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714185925910.png" alt="image-20210714185925910"></p><p>image-20210714185925910</p><p>Debugæ–¹å¼å¯åŠ¨order-serviceæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„clientï¼Œåº•å±‚å°±æ˜¯Apache HttpClientï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714190041542.png" alt="image-20210714190041542"></p><p>image-20210714190041542</p><p>Feignçš„ä¼˜åŒ–ï¼š</p><ol><li>æ—¥å¿—çº§åˆ«å°½é‡ç”¨basic</li><li>ä½¿ç”¨HttpClientæˆ–OKHttpä»£æ›¿URLConnection <ul><li>â‘  å¼•å…¥feign-httpClientä¾èµ–</li><li>â‘¡ é…ç½®æ–‡ä»¶å¼€å¯httpClientåŠŸèƒ½ï¼Œè®¾ç½®è¿æ¥æ± å‚æ•°</li></ul></li></ol><blockquote><p>BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</p></blockquote><h3 id="_2-4-æœ€ä½³å®è·µ" tabindex="-1">2.4.æœ€ä½³å®è·µ <a class="header-anchor" href="#_2-4-æœ€ä½³å®è·µ" aria-label="Permalink to &quot;2.4.æœ€ä½³å®è·µ&quot;">â€‹</a></h3><p>å‰è¨€</p><p><strong>æ‰€è°“æœ€è¿‘å®è·µï¼Œå°±æ˜¯ä½¿ç”¨è¿‡ç¨‹ä¸­æ€»ç»“çš„ç»éªŒï¼Œæœ€å¥½çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ã€‚</strong></p><p>è‡ªä¹ è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œ<strong>Feignçš„å®¢æˆ·ç«¯ä¸æœåŠ¡æä¾›è€…çš„controllerä»£ç éå¸¸ç›¸ä¼¼</strong>ï¼š</p><p><strong>feignå®¢æˆ·ç«¯ï¼š</strong></p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714190542730.png" alt="image-20210714190542730"></p><p>image-20210714190542730</p><p><strong>UserControllerï¼š</strong></p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714190528450.png" alt="image-20210714190528450"></p><p>image-20210714190528450</p><p><strong>ç®€åŒ–æ“ä½œï¼š</strong> ğŸ‘‡ğŸ‘‡</p><h4 id="_2-4-1-ç»§æ‰¿æ–¹å¼" tabindex="-1">2.4.1.ç»§æ‰¿æ–¹å¼ <a class="header-anchor" href="#_2-4-1-ç»§æ‰¿æ–¹å¼" aria-label="Permalink to &quot;2.4.1.ç»§æ‰¿æ–¹å¼&quot;">â€‹</a></h4><p>ä¸€æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å…±äº«ï¼š</p><p>1ï¼‰å®šä¹‰ä¸€ä¸ªAPIæ¥å£ï¼Œåˆ©ç”¨å®šä¹‰æ–¹æ³•ï¼Œå¹¶åŸºäºSpringMVCæ³¨è§£åšå£°æ˜ã€‚</p><p>2ï¼‰Feignå®¢æˆ·ç«¯å’ŒControlleréƒ½é›†æˆæ”¹æ¥å£</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714190640857.png" alt="image-20210714190640857"></p><p>image-20210714190640857</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®€å•</li><li>å®ç°äº†ä»£ç å…±äº«</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><p>æœåŠ¡æä¾›æ–¹ã€æœåŠ¡æ¶ˆè´¹æ–¹ç´§è€¦åˆ</p></li><li><p>å‚æ•°åˆ—è¡¨ä¸­çš„æ³¨è§£æ˜ å°„å¹¶ä¸ä¼šç»§æ‰¿ï¼Œå› æ­¤Controllerä¸­å¿…é¡»å†æ¬¡å£°æ˜æ–¹æ³•ã€å‚æ•°åˆ—è¡¨ã€æ³¨è§£</p></li></ul><h4 id="_2-4-2-æŠ½å–æ–¹å¼" tabindex="-1">2.4.2.æŠ½å–æ–¹å¼ <a class="header-anchor" href="#_2-4-2-æŠ½å–æ–¹å¼" aria-label="Permalink to &quot;2.4.2.æŠ½å–æ–¹å¼&quot;">â€‹</a></h4><p>å°†Feignçš„ClientæŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„POJOã€é»˜è®¤çš„Feigné…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå°†UserClientã€Userã€Feignçš„é»˜è®¤é…ç½®éƒ½æŠ½å–åˆ°ä¸€ä¸ªfeign-apiåŒ…ä¸­ï¼Œæ‰€æœ‰å¾®æœåŠ¡å¼•ç”¨è¯¥ä¾èµ–åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ã€‚</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714214041796.png" alt="image-20210714214041796"></p><p>image-20210714214041796</p><p><strong>å®ç°åŸºäºæŠ½å–çš„æœ€ä½³å®è·µ</strong> ğŸ‘‡</p><h5 id="_1-æŠ½å–" tabindex="-1">1ï¼‰æŠ½å– <a class="header-anchor" href="#_1-æŠ½å–" aria-label="Permalink to &quot;1ï¼‰æŠ½å–&quot;">â€‹</a></h5><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªmoduleï¼Œå‘½åä¸ºfeign-apiï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714204557771.png" alt="image-20210714204557771"></p><p>image-20210714204557771</p><p>é¡¹ç›®ç»“æ„ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714204656214.png" alt="image-20210714204656214"></p><p>image-20210714204656214</p><p>åœ¨feign-apiä¸­ç„¶åå¼•å…¥feignçš„starterä¾èµ–</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">&lt;</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;org.springframework.cloud&lt;/</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;spring-cloud-starter-openfeign&lt;/</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;/</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.springframework.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-openfeign&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>ç„¶åï¼Œorder-serviceä¸­ç¼–å†™çš„UserClientã€Userã€DefaultFeignConfigurationéƒ½å¤åˆ¶åˆ°feign-apié¡¹ç›®ä¸­</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714205221970.png" alt="image-20210714205221970"></p><p>image-20210714205221970</p><h5 id="_2-åœ¨order-serviceä¸­ä½¿ç”¨feign-api" tabindex="-1">2ï¼‰åœ¨order-serviceä¸­ä½¿ç”¨feign-api <a class="header-anchor" href="#_2-åœ¨order-serviceä¸­ä½¿ç”¨feign-api" aria-label="Permalink to &quot;2ï¼‰åœ¨order-serviceä¸­ä½¿ç”¨feign-api&quot;">â€‹</a></h5><p>é¦–å…ˆï¼Œåˆ é™¤order-serviceä¸­çš„UserClientã€Userã€DefaultFeignConfigurationç­‰ç±»æˆ–æ¥å£ã€‚</p><p>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­ä¸­å¼•å…¥feign-apiçš„ä¾èµ–ï¼š</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">&lt;</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;cn.itcast.demo&lt;/</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;feign-api&lt;/</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">version</span><span style="color:#F6F6F4;">&gt;1.0&lt;/</span><span style="color:#F286C4;">version</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;/</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;cn.itcast.demo&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;feign-api&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;1.0&lt;/</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>ä¿®æ”¹order-serviceä¸­çš„æ‰€æœ‰ä¸ä¸Šè¿°ä¸‰ä¸ªç»„ä»¶æœ‰å…³çš„å¯¼åŒ…éƒ¨åˆ†ï¼Œæ”¹æˆå¯¼å…¥feign-apiä¸­çš„åŒ…</p><h5 id="_3-é‡å¯æµ‹è¯•" tabindex="-1">3ï¼‰é‡å¯æµ‹è¯• <a class="header-anchor" href="#_3-é‡å¯æµ‹è¯•" aria-label="Permalink to &quot;3ï¼‰é‡å¯æµ‹è¯•&quot;">â€‹</a></h5><p>é‡å¯åï¼Œå‘ç°æœåŠ¡æŠ¥é”™äº†ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714205623048.png" alt="image-20210714205623048"></p><p>image-20210714205623048</p><p>è¿™æ˜¯å› ä¸ºUserClientç°åœ¨åœ¨cn.itcast.feign.clientsåŒ…ä¸‹ï¼Œ</p><p>è€Œorder-serviceçš„@EnableFeignClientsæ³¨è§£æ˜¯åœ¨cn.itcast.orderåŒ…ä¸‹ï¼Œä¸åœ¨åŒä¸€ä¸ªåŒ…ï¼Œæ— æ³•æ‰«æåˆ°UserClientã€‚</p><h5 id="_4-è§£å†³æ‰«æåŒ…é—®é¢˜" tabindex="-1">4ï¼‰è§£å†³æ‰«æåŒ…é—®é¢˜ <a class="header-anchor" href="#_4-è§£å†³æ‰«æåŒ…é—®é¢˜" aria-label="Permalink to &quot;4ï¼‰è§£å†³æ‰«æåŒ…é—®é¢˜&quot;">â€‹</a></h5><p><strong>æ–¹å¼ä¸€ï¼š</strong></p><p>æŒ‡å®šFeignåº”è¯¥æ‰«æçš„åŒ…ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">EnableFeignClients</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">basePackages</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">cn.itcast.feign.clients</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">EnableFeignClients</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">basePackages</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cn.itcast.feign.clients&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><p><strong>æ–¹å¼äºŒï¼š</strong></p><p>æŒ‡å®šéœ€è¦åŠ è½½çš„Clientæ¥å£ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">EnableFeignClients</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">clients</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> {UserClient.class})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">EnableFeignClients</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">clients</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {UserClient.class})</span></span></code></pre></div><h2 id="_3-gatewayæœåŠ¡ç½‘å…³" tabindex="-1">3.GatewayæœåŠ¡ç½‘å…³ <a class="header-anchor" href="#_3-gatewayæœåŠ¡ç½‘å…³" aria-label="Permalink to &quot;3.GatewayæœåŠ¡ç½‘å…³&quot;">â€‹</a></h2><h3 id="_3-1-ç½‘å…³ç®€ä»‹å’Œå…¥é—¨ç¨‹åº" tabindex="-1">3.1.ç½‘å…³ç®€ä»‹å’Œå…¥é—¨ç¨‹åº <a class="header-anchor" href="#_3-1-ç½‘å…³ç®€ä»‹å’Œå…¥é—¨ç¨‹åº" aria-label="Permalink to &quot;3.1.ç½‘å…³ç®€ä»‹å’Œå…¥é—¨ç¨‹åº&quot;">â€‹</a></h3><p>ç½‘å…³ç®€ä»‹å’Œå…¥é—¨ç¨‹åº</p><p>Spring Cloud Gateway æ˜¯ Spring Cloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº Spring 5.0ï¼ŒSpring Boot 2.0 å’Œ Project Reactor ç­‰å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶æµæŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p><p>Gatewayç½‘å…³æ˜¯æˆ‘ä»¬æœåŠ¡çš„å®ˆé—¨ç¥ï¼Œæ‰€æœ‰å¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£ã€‚</p><p>ç½‘å…³çš„<strong>æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</strong>ï¼š</p><ul><li>è¯·æ±‚è·¯ç”±</li><li>æƒé™æ§åˆ¶</li><li>é™æµ</li></ul><p>æ¶æ„å›¾ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714210131152.png" alt="image-20210714210131152"></p><p>image-20210714210131152</p><p><strong>æƒé™æ§åˆ¶</strong>ï¼šç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</p><p><strong>è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡gatewayï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè·¯ç”±ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚</p><p><strong>é™æµ</strong>ï¼šå½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</p><p>åœ¨SpringCloudä¸­ç½‘å…³çš„å®ç°åŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>gateway</li><li>zuul</li></ul><p>Zuulæ˜¯åŸºäºServletçš„å®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ã€‚è€ŒSpringCloudGatewayåˆ™æ˜¯åŸºäºSpring5ä¸­æä¾›çš„WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</p><p>æ¼”ç¤ºä¸‹ç½‘å…³çš„åŸºæœ¬è·¯ç”±åŠŸèƒ½ï¼š</p><ol><li>åˆ›å»ºSpringBootå·¥ç¨‹gatewayï¼Œå¼•å…¥ç½‘å…³ä¾èµ–</li><li>ç¼–å†™å¯åŠ¨ç±»</li><li>ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</li><li>å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•</li></ol><h4 id="_1-åˆ›å»ºgatewayæœåŠ¡-å¼•å…¥ä¾èµ–" tabindex="-1">1ï¼‰åˆ›å»ºgatewayæœåŠ¡ï¼Œå¼•å…¥ä¾èµ– <a class="header-anchor" href="#_1-åˆ›å»ºgatewayæœåŠ¡-å¼•å…¥ä¾èµ–" aria-label="Permalink to &quot;1ï¼‰åˆ›å»ºgatewayæœåŠ¡ï¼Œå¼•å…¥ä¾èµ–&quot;">â€‹</a></h4><p>åˆ›å»ºæœåŠ¡ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714210919458.png" alt="image-20210714210919458"></p><p>image-20210714210919458</p><p>å¼•å…¥ä¾èµ–ï¼š</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">&lt;!--ç½‘å…³--&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;org.springframework.cloud&lt;/</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;spring-cloud-starter-gateway&lt;/</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;/</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#7B7F8B;">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#F286C4;">groupId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">    &lt;</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/</span><span style="color:#F286C4;">artifactId</span><span style="color:#F6F6F4;">&gt;</span></span>
<span class="line"><span style="color:#F6F6F4;">&lt;/</span><span style="color:#F286C4;">dependency</span><span style="color:#F6F6F4;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!--ç½‘å…³--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;org.springframework.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-gateway&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;com.alibaba.cloud&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><h4 id="_2-ç¼–å†™å¯åŠ¨ç±»" tabindex="-1">2ï¼‰ç¼–å†™å¯åŠ¨ç±» <a class="header-anchor" href="#_2-ç¼–å†™å¯åŠ¨ç±»" aria-label="Permalink to &quot;2ï¼‰ç¼–å†™å¯åŠ¨ç±»&quot;">â€‹</a></h4><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">package</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">cn.itcast.gateway</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.boot.SpringApplication;</span></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.boot.autoconfigure.SpringBootApplication;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">SpringBootApplication</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">GatewayApplication</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">	</span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">main</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;">[] </span><span style="color:#FFB86C;font-style:italic;">args</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">		SpringApplication.</span><span style="color:#62E884;">run</span><span style="color:#F6F6F4;">(GatewayApplication.class, args);</span></span>
<span class="line"><span style="color:#F6F6F4;">	}</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> cn.itcast.gateway;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.boot.SpringApplication;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.boot.autoconfigure.SpringBootApplication;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">SpringBootApplication</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GatewayApplication</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">		SpringApplication.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(GatewayApplication.class, args);</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h4 id="_3-ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™" tabindex="-1">3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™ <a class="header-anchor" href="#_3-ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™" aria-label="Permalink to &quot;3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™&quot;">â€‹</a></h4><p>åˆ›å»ºapplication.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">server</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">port</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">10010</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># ç½‘å…³ç«¯å£</span></span>
<span class="line"><span style="color:#97E1F1;">spring</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">application</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">name</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">gateway</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æœåŠ¡åç§°</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">cloud</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">nacos</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">server-addr</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">localhost:8848</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># nacosåœ°å€</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">gateway</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">routes</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># ç½‘å…³è·¯ç”±é…ç½®</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">id</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">user-service</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span></span>
<span class="line"><span style="color:#F6F6F4;">          </span><span style="color:#7B7F8B;"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span></span>
<span class="line"><span style="color:#F6F6F4;">          </span><span style="color:#97E1F1;">uri</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">lb://userservice</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></span>
<span class="line"><span style="color:#F6F6F4;">          </span><span style="color:#97E1F1;">predicates</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">Path=/user/**</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">server</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10010</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ç½‘å…³ç«¯å£</span></span>
<span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">application</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">gateway</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æœåŠ¡åç§°</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cloud</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nacos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">server-addr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localhost:8848</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># nacosåœ°å€</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">gateway</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">routes</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># ç½‘å…³è·¯ç”±é…ç½®</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">user-service</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6A737D;"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">uri</span><span style="color:#24292E;">: </span><span style="color:#032F62;">lb://userservice</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">predicates</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#032F62;">Path=/user/**</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></span></code></pre></div><p>æˆ‘ä»¬å°†ç¬¦åˆ<code>Path</code> è§„åˆ™çš„ä¸€åˆ‡è¯·æ±‚ï¼Œéƒ½ä»£ç†åˆ° <code>uri</code>å‚æ•°æŒ‡å®šçš„åœ°å€ã€‚</p><p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† <code>/user/**</code>å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ°<code>lb://userservice</code>ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æœåŠ¡åæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h4 id="_5-ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾" tabindex="-1">5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾ <a class="header-anchor" href="#_5-ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾" aria-label="Permalink to &quot;5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾&quot;">â€‹</a></h4><p>æ•´ä¸ªè®¿é—®çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714211742956.png" alt="image-20210714211742956"></p><p>image-20210714211742956</p><p>æ€»ç»“</p><p><strong>ç½‘å…³æ­å»ºæ­¥éª¤ï¼š</strong></p><ol><li>åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥nacosæœåŠ¡å‘ç°å’Œgatewayä¾èµ–</li><li>é…ç½®application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€nacosåœ°å€ã€è·¯ç”±</li></ol><p><strong>è·¯ç”±é…ç½®åŒ…æ‹¬ï¼š</strong></p><ol><li>è·¯ç”±idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</li><li>è·¯ç”±ç›®æ ‡ï¼ˆuriï¼‰ï¼šè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œhttpä»£è¡¨å›ºå®šåœ°å€ï¼Œlbä»£è¡¨æ ¹æ®æœåŠ¡åè´Ÿè½½å‡è¡¡</li><li>è·¯ç”±æ–­è¨€ï¼ˆpredicatesï¼‰ï¼šåˆ¤æ–­è·¯ç”±çš„è§„åˆ™ï¼Œ</li><li>è·¯ç”±è¿‡æ»¤å™¨ï¼ˆfiltersï¼‰ï¼šå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†</li></ol><h3 id="_3-2-è·¯ç”±æ–­è¨€å·¥å‚" tabindex="-1">3.2.è·¯ç”±æ–­è¨€å·¥å‚ <a class="header-anchor" href="#_3-2-è·¯ç”±æ–­è¨€å·¥å‚" aria-label="Permalink to &quot;3.2.è·¯ç”±æ–­è¨€å·¥å‚&quot;">â€‹</a></h3><p>å‰è¨€</p><p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„<strong>æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²</strong>ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢«<code>Predicate Factory</code>è¯»å–å¹¶å¤„ç†ï¼Œ<code>è½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</code></p><p>ä¾‹å¦‚Path=/user/**æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±</p><p><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>ç±»æ¥</p><p>å¤„ç†çš„ï¼Œåƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨SpringCloudGatewayè¿˜æœ‰åå‡ ä¸ª:</p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>After</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td><td>- After=2037-01-20T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Before</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>- Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]</td></tr><tr><td>Between</td><td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>- Between=2037-01-20T17:42:47.789-07:00[America/Denver], 2037-01-21T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Cookie</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td><td>- Cookie=chocolate, ch.p</td></tr><tr><td>Header</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td><td>- Header=X-Request-Id, \\d+</td></tr><tr><td>Host</td><td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td><td>- Host=<strong>.somehost.org,</strong>.anotherhost.org</td></tr><tr><td>Method</td><td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td><td>- Method=GET,POST</td></tr><tr><td>Path</td><td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td><td>- Path=/red/{segment},/blue/**</td></tr><tr><td>Query</td><td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td><td>- Query=name, Jackæˆ–è€…- Query=name</td></tr><tr><td>RemoteAddr</td><td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td><td>- RemoteAddr=192.168.1.1/24</td></tr><tr><td>Weight</td><td>æƒé‡å¤„ç†</td><td></td></tr></tbody></table><p>æˆ‘ä»¬åªéœ€è¦æŒæ¡Pathè¿™ç§è·¯ç”±å·¥ç¨‹å°±å¯ä»¥äº†ã€‚</p><h3 id="_3-3-è¿‡æ»¤å™¨å·¥å‚" tabindex="-1">3.3.è¿‡æ»¤å™¨å·¥å‚ <a class="header-anchor" href="#_3-3-è¿‡æ»¤å™¨å·¥å‚" aria-label="Permalink to &quot;3.3.è¿‡æ»¤å™¨å·¥å‚&quot;">â€‹</a></h3><p>è¿‡æ»¤å™¨å·¥å‚</p><p>GatewayFilteræ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡è¿”å›çš„å“åº”åšå¤„ç†ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714212312871.png" alt="image-20210714212312871"></p><p>image-20210714212312871</p><h4 id="_3-4-1-è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»" tabindex="-1">3.4.1.è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±» <a class="header-anchor" href="#_3-4-1-è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»" aria-label="Permalink to &quot;3.4.1.è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»&quot;">â€‹</a></h4><p>Springæä¾›äº†31ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š</p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>AddRequestHeader</td><td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>RemoveRequestHeader</td><td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>AddResponseHeader</td><td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RemoveResponseHeader</td><td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RequestRateLimiter</td><td>é™åˆ¶è¯·æ±‚çš„æµé‡</td></tr></tbody></table><h4 id="_3-4-2-è¯·æ±‚å¤´è¿‡æ»¤å™¨" tabindex="-1">3.4.2.è¯·æ±‚å¤´è¿‡æ»¤å™¨ <a class="header-anchor" href="#_3-4-2-è¯·æ±‚å¤´è¿‡æ»¤å™¨" aria-label="Permalink to &quot;3.4.2.è¯·æ±‚å¤´è¿‡æ»¤å™¨&quot;">â€‹</a></h4><p>ä¸‹é¢æˆ‘ä»¬ä»¥AddRequestHeader ä¸ºä¾‹æ¥è®²è§£ã€‚</p><blockquote><p><strong>éœ€æ±‚</strong>ï¼šç»™æ‰€æœ‰è¿›å…¥userserviceçš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šTruth=itcast is freaking awesome!</p></blockquote><p>åªéœ€è¦ä¿®æ”¹gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±è¿‡æ»¤å³å¯ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">spring</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">cloud</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">gateway</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">routes</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">id</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">user-service</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">uri</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">lb://userservice</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">predicates</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">Path=/user/**</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">filters</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è¿‡æ»¤å™¨</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">AddRequestHeader=Truth, Itcast is freaking awesome!</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æ·»åŠ è¯·æ±‚å¤´</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cloud</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">gateway</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">routes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">user-service</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uri</span><span style="color:#24292E;">: </span><span style="color:#032F62;">lb://userservice</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">predicates</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">Path=/user/**</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">filters</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># è¿‡æ»¤å™¨</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">AddRequestHeader=Truth, Itcast is freaking awesome!</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æ·»åŠ è¯·æ±‚å¤´</span></span></code></pre></div><p>å½“å‰è¿‡æ»¤å™¨å†™åœ¨userserviceè·¯ç”±ä¸‹ï¼Œå› æ­¤ä»…ä»…å¯¹è®¿é—®userserviceçš„è¯·æ±‚æœ‰æ•ˆã€‚</p><h4 id="_3-4-3-é»˜è®¤è¿‡æ»¤å™¨" tabindex="-1">3.4.3.é»˜è®¤è¿‡æ»¤å™¨ <a class="header-anchor" href="#_3-4-3-é»˜è®¤è¿‡æ»¤å™¨" aria-label="Permalink to &quot;3.4.3.é»˜è®¤è¿‡æ»¤å™¨&quot;">â€‹</a></h4><p>å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ°defaultä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">spring</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">cloud</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">gateway</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">routes</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">id</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">user-service</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">uri</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">lb://userservice</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">predicates</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">Path=/user/**</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">default-filters</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># é»˜è®¤è¿‡æ»¤é¡¹</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#E7EE98;">AddRequestHeader=Truth, Itcast is freaking awesome!</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cloud</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">gateway</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">routes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">user-service</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uri</span><span style="color:#24292E;">: </span><span style="color:#032F62;">lb://userservice</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">predicates</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">Path=/user/**</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">default-filters</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># é»˜è®¤è¿‡æ»¤é¡¹</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">AddRequestHeader=Truth, Itcast is freaking awesome!</span></span></code></pre></div><p>æ€»ç»“</p><ol><li>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ <ul><li>â‘  å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</li><li>â‘¡ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ</li></ul></li><li>defaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ <ul><li>â‘  å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</li></ul></li></ol><h3 id="_3-4-å…¨å±€è¿‡æ»¤å™¨" tabindex="-1">3.4.å…¨å±€è¿‡æ»¤å™¨ <a class="header-anchor" href="#_3-4-å…¨å±€è¿‡æ»¤å™¨" aria-label="Permalink to &quot;3.4.å…¨å±€è¿‡æ»¤å™¨&quot;">â€‹</a></h3><p>å‰è¨€</p><p>ä¸Šä¸€èŠ‚å­¦ä¹ çš„è¿‡æ»¤å™¨ï¼Œç½‘å…³æä¾›äº†31ç§ï¼Œä½†æ¯ä¸€ç§è¿‡æ»¤å™¨çš„ä½œç”¨éƒ½æ˜¯å›ºå®šçš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªè¯·æ±‚ï¼Œåšè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åˆ™æ²¡åŠæ³•å®ç°ã€‚</p><h4 id="_3-5-1-å…¨å±€è¿‡æ»¤å™¨ä½œç”¨" tabindex="-1">3.5.1.å…¨å±€è¿‡æ»¤å™¨ä½œç”¨ <a class="header-anchor" href="#_3-5-1-å…¨å±€è¿‡æ»¤å™¨ä½œç”¨" aria-label="Permalink to &quot;3.5.1.å…¨å±€è¿‡æ»¤å™¨ä½œç”¨&quot;">â€‹</a></h4><p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸GatewayFilterçš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äºGatewayFilteré€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›è€ŒGlobalFilterçš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚</p><p>å®šä¹‰æ–¹å¼æ˜¯å®ç°GlobalFilteræ¥å£ã€‚</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">interface</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">GlobalFilter</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     *  å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡{@link GatewayFilterChain}å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†</span></span>
<span class="line"><span style="color:#7B7F8B;">     *</span></span>
<span class="line"><span style="color:#7B7F8B;">     * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">exchange</span><span style="color:#7B7F8B;"> è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯</span></span>
<span class="line"><span style="color:#7B7F8B;">     * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">chain</span><span style="color:#7B7F8B;"> ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ </span></span>
<span class="line"><span style="color:#7B7F8B;">     * </span><span style="color:#F286C4;">@return</span><span style="color:#7B7F8B;"> {@code Mono&lt;Void&gt;} è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">Mono</span><span style="color:#F6F6F4;">&lt;Void&gt; </span><span style="color:#62E884;">filter</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">ServerWebExchange</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">exchange</span><span style="color:#F6F6F4;">, </span><span style="color:#97E1F1;font-style:italic;">GatewayFilterChain</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">chain</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">interface</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GlobalFilter</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     *  å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡{@link GatewayFilterChain}å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†</span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">exchange</span><span style="color:#6A737D;"> è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">chain</span><span style="color:#6A737D;"> ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ </span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@return</span><span style="color:#6A737D;"> {@code Mono&lt;Void&gt;} è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    Mono&lt;</span><span style="color:#D73A49;">Void</span><span style="color:#24292E;">&gt; </span><span style="color:#6F42C1;">filter</span><span style="color:#24292E;">(ServerWebExchange </span><span style="color:#E36209;">exchange</span><span style="color:#24292E;">, GatewayFilterChain </span><span style="color:#E36209;">chain</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>åœ¨filterä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</p><ul><li>ç™»å½•çŠ¶æ€åˆ¤æ–­</li><li>æƒé™æ ¡éªŒ</li><li>è¯·æ±‚é™æµç­‰</li></ul><h4 id="_3-5-2-è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" tabindex="-1">3.5.2.è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ <a class="header-anchor" href="#_3-5-2-è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" aria-label="Permalink to &quot;3.5.2.è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨&quot;">â€‹</a></h4><p>éœ€æ±‚ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š</p><ul><li><p>å‚æ•°ä¸­æ˜¯å¦æœ‰authorizationï¼Œ</p></li><li><p>authorizationå‚æ•°å€¼æ˜¯å¦ä¸ºadmin</p></li></ul><p>å¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª</p><p>å®ç°ï¼š</p><p>åœ¨gatewayä¸­å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">// 1.è·å–è¯·æ±‚å‚æ•°</span></span>
<span class="line"><span style="color:#7B7F8B;">// 2.è·å–authorizationå‚æ•°</span></span>
<span class="line"><span style="color:#7B7F8B;">// 3.æ ¡éªŒ</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// æ”¾è¡Œ</span></span>
<span class="line"><span style="color:#7B7F8B;">// 4.æ‹¦æˆª</span></span>
<span class="line"><span style="color:#7B7F8B;">// 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#7B7F8B;">// 4.2.ç»“æŸå¤„ç†</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 1.è·å–è¯·æ±‚å‚æ•°</span></span>
<span class="line"><span style="color:#6A737D;">// 2.è·å–authorizationå‚æ•°</span></span>
<span class="line"><span style="color:#6A737D;">// 3.æ ¡éªŒ</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// æ”¾è¡Œ</span></span>
<span class="line"><span style="color:#6A737D;">// 4.æ‹¦æˆª</span></span>
<span class="line"><span style="color:#6A737D;">// 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#6A737D;">// 4.2.ç»“æŸå¤„ç†</span></span></code></pre></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">package</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">cn.itcast.gateway.filters</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.cloud.gateway.filter.GlobalFilter;</span></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.core.annotation.Order;</span></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.http.HttpStatus;</span></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.stereotype.Component;</span></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> org.springframework.web.server.ServerWebExchange;</span></span>
<span class="line"><span style="color:#F286C4;">import</span><span style="color:#F6F6F4;"> reactor.core.publisher.Mono;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Order</span><span style="color:#F6F6F4;">(</span><span style="color:#F286C4;">-</span><span style="color:#BF9EEE;">1</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Component</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">AuthorizeFilter</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">implements</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">GlobalFilter</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Override</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Mono</span><span style="color:#F6F6F4;">&lt;Void&gt; </span><span style="color:#62E884;">filter</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">ServerWebExchange</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">exchange</span><span style="color:#F6F6F4;">, </span><span style="color:#97E1F1;font-style:italic;">GatewayFilterChain</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">chain</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// 1.è·å–è¯·æ±‚å‚æ•°</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">MultiValueMap</span><span style="color:#F6F6F4;">&lt;String, String&gt; params </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> exchange.</span><span style="color:#62E884;">getRequest</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">getQueryParams</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// 2.è·å–authorizationå‚æ•°</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> auth </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> params.</span><span style="color:#62E884;">getFirst</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">authorization</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// 3.æ ¡éªŒ</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">admin</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">.</span><span style="color:#62E884;">equals</span><span style="color:#F6F6F4;">(auth)) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#7B7F8B;">// æ”¾è¡Œ</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> chain.</span><span style="color:#62E884;">filter</span><span style="color:#F6F6F4;">(exchange);</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// 4.æ‹¦æˆª</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#F6F6F4;">        exchange.</span><span style="color:#62E884;">getResponse</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">setStatusCode</span><span style="color:#F6F6F4;">(HttpStatus.FORBIDDEN);</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// 4.2.ç»“æŸå¤„ç†</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> exchange.</span><span style="color:#62E884;">getResponse</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">setComplete</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> cn.itcast.gateway.filters;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.cloud.gateway.filter.GlobalFilter;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.core.annotation.Order;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.http.HttpStatus;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.stereotype.Component;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.springframework.web.server.ServerWebExchange;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> reactor.core.publisher.Mono;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Order</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Component</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AuthorizeFilter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GlobalFilter</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> Mono&lt;</span><span style="color:#D73A49;">Void</span><span style="color:#24292E;">&gt; </span><span style="color:#6F42C1;">filter</span><span style="color:#24292E;">(ServerWebExchange </span><span style="color:#E36209;">exchange</span><span style="color:#24292E;">, GatewayFilterChain </span><span style="color:#E36209;">chain</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 1.è·å–è¯·æ±‚å‚æ•°</span></span>
<span class="line"><span style="color:#24292E;">        MultiValueMap&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; params </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exchange.</span><span style="color:#6F42C1;">getRequest</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getQueryParams</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 2.è·å–authorizationå‚æ•°</span></span>
<span class="line"><span style="color:#24292E;">        String auth </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> params.</span><span style="color:#6F42C1;">getFirst</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;authorization&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 3.æ ¡éªŒ</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&quot;admin&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">equals</span><span style="color:#24292E;">(auth)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// æ”¾è¡Œ</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> chain.</span><span style="color:#6F42C1;">filter</span><span style="color:#24292E;">(exchange);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 4.æ‹¦æˆª</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 4.1.ç¦æ­¢è®¿é—®ï¼Œè®¾ç½®çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#24292E;">        exchange.</span><span style="color:#6F42C1;">getResponse</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">setStatusCode</span><span style="color:#24292E;">(HttpStatus.FORBIDDEN);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 4.2.ç»“æŸå¤„ç†</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> exchange.</span><span style="color:#6F42C1;">getResponse</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">setComplete</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h4 id="_3-5-3-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" tabindex="-1">3.5.3.è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº <a class="header-anchor" href="#_3-5-3-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" aria-label="Permalink to &quot;3.5.3.è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº&quot;">â€‹</a></h4><p>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€DefaultFilterã€GlobalFilter</p><p>è¯·æ±‚è·¯ç”±åï¼Œä¼šå°†å½“å‰è·¯ç”±è¿‡æ»¤å™¨å’ŒDefaultFilterã€GlobalFilterï¼Œåˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆé›†åˆï¼‰ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714214228409.png" alt="image-20210714214228409"></p><p>image-20210714214228409</p><p>æ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œ<strong>orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</strong>ã€‚</li><li>GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li><li>è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä»1é€’å¢ã€‚</li><li>å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œã€‚</li></ul><p>è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼š</p><p><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()</code>æ–¹æ³•æ˜¯å…ˆåŠ è½½defaultFiltersï¼Œç„¶åå†åŠ è½½æŸä¸ªrouteçš„filtersï¼Œç„¶ååˆå¹¶ã€‚</p><p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler#handle()</code>æ–¹æ³•ä¼šåŠ è½½å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸å‰é¢çš„è¿‡æ»¤å™¨åˆå¹¶åæ ¹æ®orderæ’åºï¼Œç»„ç»‡è¿‡æ»¤å™¨é“¾</p><h3 id="_3-5-è·¨åŸŸé—®é¢˜" tabindex="-1">3.5.è·¨åŸŸé—®é¢˜ <a class="header-anchor" href="#_3-5-è·¨åŸŸé—®é¢˜" aria-label="Permalink to &quot;3.5.è·¨åŸŸé—®é¢˜&quot;">â€‹</a></h3><p>è·¨åŸŸé—®é¢˜</p><p><strong>ä»£ç æ“ä½œ</strong></p><h4 id="_3-6-2-æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜" tabindex="-1">3.6.2.æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜ <a class="header-anchor" href="#_3-6-2-æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜" aria-label="Permalink to &quot;3.6.2.æ¨¡æ‹Ÿè·¨åŸŸé—®é¢˜&quot;">â€‹</a></h4><p>æ‰¾åˆ°è¯¾å‰èµ„æ–™çš„é¡µé¢æ–‡ä»¶ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714215713563.png" alt="image-20210714215713563"></p><p>image-20210714215713563</p><p>æ”¾å…¥tomcatæˆ–è€…nginxè¿™æ ·çš„webæœåŠ¡å™¨ä¸­ï¼Œå¯åŠ¨å¹¶è®¿é—®ã€‚</p><p>å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š</p><p><img src="http://image.yangeit.cn/i/2023/05/11/image-20210714215832675.png" alt="image-20210714215832675"></p><p>image-20210714215832675</p><p>ä»localhost:8090è®¿é—®localhost:10010ï¼Œç«¯å£ä¸åŒï¼Œæ˜¾ç„¶æ˜¯è·¨åŸŸçš„è¯·æ±‚ã€‚</p><h4 id="_3-6-3-è§£å†³è·¨åŸŸé—®é¢˜" tabindex="-1">3.6.3.è§£å†³è·¨åŸŸé—®é¢˜ <a class="header-anchor" href="#_3-6-3-è§£å†³è·¨åŸŸé—®é¢˜" aria-label="Permalink to &quot;3.6.3.è§£å†³è·¨åŸŸé—®é¢˜&quot;">â€‹</a></h4><p>åœ¨gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;">spring</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#97E1F1;">cloud</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;">gateway</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#7B7F8B;"># ã€‚ã€‚ã€‚</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;">globalcors</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">add-to-simple-url-handler-mapping</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">true</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;">corsConfigurations</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">          </span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">[/**]</span><span style="color:#DEE492;">&#39;</span><span style="color:#F286C4;">:</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;">allowedOrigins</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ </span></span>
<span class="line"><span style="color:#F6F6F4;">              </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">http://localhost:8090</span><span style="color:#DEE492;">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;">allowedMethods</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span></span>
<span class="line"><span style="color:#F6F6F4;">              </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">GET</span><span style="color:#DEE492;">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4;">              </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">POST</span><span style="color:#DEE492;">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4;">              </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">DELETE</span><span style="color:#DEE492;">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4;">              </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">PUT</span><span style="color:#DEE492;">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4;">              </span><span style="color:#F286C4;">-</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">OPTIONS</span><span style="color:#DEE492;">&quot;</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;">allowedHeaders</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">*</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;">allowCredentials</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">true</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># æ˜¯å¦å…è®¸æºå¸¦cookie</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;">maxAge</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">360000</span><span style="color:#F6F6F4;"> </span><span style="color:#7B7F8B;"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">spring</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cloud</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">gateway</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># ã€‚ã€‚ã€‚</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">globalcors</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">add-to-simple-url-handler-mapping</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">corsConfigurations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#032F62;">&#39;[/**]&#39;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">allowedOrigins</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ </span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#032F62;">&quot;http://localhost:8090&quot;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">allowedMethods</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#032F62;">&quot;GET&quot;</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#032F62;">&quot;POST&quot;</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#032F62;">&quot;DELETE&quot;</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#032F62;">&quot;PUT&quot;</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#032F62;">&quot;OPTIONS&quot;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">allowedHeaders</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;*&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">allowCredentials</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># æ˜¯å¦å…è®¸æºå¸¦cookie</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">maxAge</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">360000</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span></span></code></pre></div>`,337),e=[o];function t(c,r,i,y,F,d){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{E as __pageData,u as default};

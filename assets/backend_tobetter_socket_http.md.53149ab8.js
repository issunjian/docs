import{_ as s,o as n,c as a,V as p}from"./chunks/framework.c6d8cbec.js";const l="/docs/assets/http-20230331112928.6908fe9b.png",o="/docs/assets/http-20230331114404.f29605a4.png",e="/docs/assets/http-20230331120336.fe30d311.png",t="/docs/assets/http-f314ade3-9006-4caa-b905-5726121826c4.d02b3671.gif",c="/docs/assets/http-59db6211-792a-494f-b01a-9d5848eceed1.fecfc0cf.gif",A=JSON.parse('{"title":"ç‰›é€¼ï¼Œç”¨Java Socketæ‰‹æ’¸äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨","description":"æœ¬æ–‡è¯¦ç»†è®²è§£äº†å¦‚ä½•ä½¿ç”¨Java Socketç¼–ç¨‹æŠ€æœ¯æ‰‹åŠ¨æ„å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨ã€‚ä»æœåŠ¡å™¨çš„åŸºæœ¬æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°å…·ä½“çš„å®ç°æ–¹æ³•ï¼Œä»¥åŠæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯çš„äº¤äº’è¿‡ç¨‹ã€‚é€šè¿‡æœ¬æ–‡ï¼Œæ‚¨å°†å­¦ä¼šä½¿ç”¨Java Socketç¼–ç¨‹æŠ€å·§ï¼Œæ‰‹æ’¸ä¸€ä¸ªç®€æ˜“çš„HTTPæœåŠ¡å™¨ï¼Œå¹¶æŒæ¡ç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒæŠ€æœ¯ã€‚","frontmatter":{"title":"ç‰›é€¼ï¼Œç”¨Java Socketæ‰‹æ’¸äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨","shortTitle":"ç”¨Socketå®ç°ä¸€ä¸ªHTTPæœåŠ¡å™¨","description":"æœ¬æ–‡è¯¦ç»†è®²è§£äº†å¦‚ä½•ä½¿ç”¨Java Socketç¼–ç¨‹æŠ€æœ¯æ‰‹åŠ¨æ„å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨ã€‚ä»æœåŠ¡å™¨çš„åŸºæœ¬æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°å…·ä½“çš„å®ç°æ–¹æ³•ï¼Œä»¥åŠæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯çš„äº¤äº’è¿‡ç¨‹ã€‚é€šè¿‡æœ¬æ–‡ï¼Œæ‚¨å°†å­¦ä¼šä½¿ç”¨Java Socketç¼–ç¨‹æŠ€å·§ï¼Œæ‰‹æ’¸ä¸€ä¸ªç®€æ˜“çš„HTTPæœåŠ¡å™¨ï¼Œå¹¶æŒæ¡ç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒæŠ€æœ¯ã€‚","category":["Javaæ ¸å¿ƒ"],"tag":["Javaç½‘ç»œç¼–ç¨‹"],"head":[["meta",{"name":"keywords","content":"Java,Java SE,JavaåŸºç¡€,Javaæ•™ç¨‹,Javaç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯,Javaè¿›é˜¶ä¹‹è·¯,Javaå…¥é—¨,æ•™ç¨‹,JavaSocket,javaç½‘ç»œç¼–ç¨‹,ç½‘ç»œç¼–ç¨‹,http,socket http,http æœåŠ¡å™¨,java æœåŠ¡å™¨,HTTPæœåŠ¡å™¨"}]]},"headers":[],"relativePath":"backend/tobetter/socket/http.md","filePath":"backend/tobetter/socket/http.md"}'),r={name:"backend/tobetter/socket/http.md"},y=p(`<h1 id="_11-3-ç”¨socketå®ç°ä¸€ä¸ªhttpæœåŠ¡å™¨" tabindex="-1">11.3 ç”¨Socketå®ç°ä¸€ä¸ªHTTPæœåŠ¡å™¨ <a class="header-anchor" href="#_11-3-ç”¨socketå®ç°ä¸€ä¸ªhttpæœåŠ¡å™¨" aria-label="Permalink to &quot;11.3 ç”¨Socketå®ç°ä¸€ä¸ªHTTPæœåŠ¡å™¨&quot;">â€‹</a></h1><p>ä½œä¸ºä¸€ä¸ª Java åç«¯ï¼Œæä¾› HTTP æœåŠ¡å¯ä»¥è¯´æ˜¯åŸºæœ¬æŠ€èƒ½ä¹‹ä¸€äº†ï¼Œä½†æ˜¯ä½ çœŸçš„äº†è§£ HTTP åè®®ä¹ˆï¼Ÿä½ çŸ¥é“çŸ¥é“å¦‚ä½•æ‰‹æ’¸ä¸€ä¸ª HTTP æœåŠ¡å™¨ä¹ˆï¼ŸTomcat çš„åº•å±‚æ˜¯æ€ä¹ˆæ”¯æŒ HTTP æœåŠ¡çš„å‘¢ï¼Ÿå¤§åé¼é¼çš„ Servlet åˆæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Œè¯¥æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ</p><p>åœ¨åˆå­¦ Java æ—¶ï¼ŒSocket ç¼–ç¨‹æ˜¯é€ƒä¸æ‰çš„ä¸€ç« ï¼›è™½ç„¶åœ¨å®é™…ä¸šåŠ¡é¡¹ç›®ä¸­ï¼Œä½¿ç”¨è¿™ä¸ªçš„å¯èƒ½æ€§åŸºæœ¬ä¸º 0ï¼Œ ä½†å¹¶ä¸æ„å‘³ç€ä¸ç”¨å­¦ã€‚æœ¬ç¯‡å°†ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Socket æ¥å®ç°ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œæä¾›å¸¸è§çš„ get/post è¯·æ±‚æ”¯æŒï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­äº†è§£ä¸‹ HTTP åè®®ã€‚</p><h3 id="i-http-æœåŠ¡å™¨ä»-0-åˆ°-1" tabindex="-1">I. HTTP æœåŠ¡å™¨ä» 0 åˆ° 1 <a class="header-anchor" href="#i-http-æœåŠ¡å™¨ä»-0-åˆ°-1" aria-label="Permalink to &quot;I. HTTP æœåŠ¡å™¨ä» 0 åˆ° 1&quot;">â€‹</a></h3><p>æ—¢ç„¶æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å€ŸåŠ© Socket æ¥æ­å»º HTTP æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®è®¤ä¸¤ç‚¹ï¼Œä¸€æ˜¯å¦‚ä½•ä½¿ç”¨ Socketï¼›å¦ä¸€ä¸ªåˆ™æ˜¯ HTTP åè®®å¦‚ä½•è§£ææ•°æ®ï¼›ä¸‹é¢åˆ†åˆ«è¿›è¡Œè¯´æ˜ã€‚</p><h4 id="_1-socket-ç¼–ç¨‹åŸºç¡€" tabindex="-1">1. Socket ç¼–ç¨‹åŸºç¡€ <a class="header-anchor" href="#_1-socket-ç¼–ç¨‹åŸºç¡€" aria-label="Permalink to &quot;1\\. Socket ç¼–ç¨‹åŸºç¡€&quot;">â€‹</a></h4><p>æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨ <a href="https://tobebetterjavaer.com/socket/socket.html" target="_blank" rel="noreferrer">ServerSocket</a> æ¥ç»‘å®šç«¯å£ï¼Œæä¾› TCP æœåŠ¡ï¼ŒåŸºæœ¬ä½¿ç”¨å§¿åŠ¿ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬å¥—è·¯å¦‚ä¸‹</p><ul><li>åˆ›å»º ServerSocket å¯¹è±¡ï¼Œç»‘å®šç›‘å¬ç«¯å£</li><li>é€šè¿‡ <code>accept()</code> æ–¹æ³•ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚</li><li>è¿æ¥å»ºç«‹åï¼Œé€šè¿‡è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯</li><li>é€šè¿‡è¾“å‡ºæµå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯</li><li>å…³é—­ç›¸å…³èµ„æº</li></ul><p>å¯¹åº”çš„ä¼ªä»£ç å¦‚ä¸‹:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#97E1F1;font-style:italic;">ServerSocket</span><span style="color:#F6F6F4;"> serverSocket </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ServerSocket</span><span style="color:#F6F6F4;">(port, ip)</span></span>
<span class="line"><span style="color:#F6F6F4;">serverSocket.</span><span style="color:#62E884;">accept</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#7B7F8B;">// æ¥æ”¶è¯·æ±‚æ•°æ®</span></span>
<span class="line"><span style="color:#F6F6F4;">socket.</span><span style="color:#62E884;">getInputStream</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">// è¿”å›æ•°æ®ç»™è¯·æ±‚æ–¹</span></span>
<span class="line"><span style="color:#F6F6F4;">out </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> socket.</span><span style="color:#62E884;">getOutputStream</span><span style="color:#F6F6F4;">()</span></span>
<span class="line"><span style="color:#F6F6F4;">out.</span><span style="color:#62E884;">print</span><span style="color:#F6F6F4;">(xxx)</span></span>
<span class="line"><span style="color:#F6F6F4;">out.</span><span style="color:#62E884;">flush</span><span style="color:#F6F6F4;">();;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">// å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#F6F6F4;">socket.</span><span style="color:#62E884;">close</span><span style="color:#F6F6F4;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ServerSocket serverSocket </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServerSocket</span><span style="color:#24292E;">(port, ip)</span></span>
<span class="line"><span style="color:#24292E;">serverSocket.</span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// æ¥æ”¶è¯·æ±‚æ•°æ®</span></span>
<span class="line"><span style="color:#24292E;">socket.</span><span style="color:#6F42C1;">getInputStream</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// è¿”å›æ•°æ®ç»™è¯·æ±‚æ–¹</span></span>
<span class="line"><span style="color:#24292E;">out </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> socket.</span><span style="color:#6F42C1;">getOutputStream</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">out.</span><span style="color:#6F42C1;">print</span><span style="color:#24292E;">(xxx)</span></span>
<span class="line"><span style="color:#24292E;">out.</span><span style="color:#6F42C1;">flush</span><span style="color:#24292E;">();;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å…³é—­è¿æ¥</span></span>
<span class="line"><span style="color:#24292E;">socket.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">()</span></span></code></pre></div><p>å…·ä½“çš„ä»£ç ï¼Œæˆ‘ä»¬å‰é¢çš„ç« èŠ‚è¯¦ç»†åœ°è®²è¿‡äº†ï¼Œç¬¬ä¸€æ¬¡æ¥çš„å°ä¼™ä¼´å¯ä»¥<a href="https://tobebetterjavaer.com/socket/socket.html" target="_blank" rel="noreferrer">æˆ³é“¾æ¥</a>å»å­¦ä¹ ä¸€ä¸‹ã€‚</p><h4 id="_2-http-åè®®" tabindex="-1">2. HTTP åè®® <a class="header-anchor" href="#_2-http-åè®®" aria-label="Permalink to &quot;2\\. HTTP åè®®&quot;">â€‹</a></h4><p>ServerSocket èµ°çš„æ˜¯ <a href="https://tobebetterjavaer.com/socket/network-base.html" target="_blank" rel="noreferrer">TCP åè®®</a>ï¼ŒHTTP åè®®æœ¬èº«æ˜¯åœ¨ TCP åè®®ä¹‹ä¸Šçš„ä¸€å±‚ã€‚</p><p>TCP æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚åè®®ã€‚TCP åœ¨ä¸¤ä¸ªç½‘ç»œèŠ‚ç‚¹ä¹‹é—´æä¾›äº†ä¸€æ¡å¯é çš„é€šä¿¡ä¿¡é“ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ã€é‡å¤æˆ–ä¹±åºã€‚TCP ä½¿ç”¨æ¡æ‰‹è¿‡ç¨‹å»ºç«‹è¿æ¥ï¼Œé€šè¿‡ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ç¡®ä¿æ•°æ®å¯é ä¼ è¾“ï¼Œå¹¶ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ç®—æ³•æ¥ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ã€‚</p><p>HTTP æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Web æµè§ˆå™¨å’Œ Web æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“è¶…æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘å’Œå…¶ä»–åª’ä½“èµ„æºçš„åº”ç”¨å±‚åè®®ã€‚HTTP ä½¿ç”¨è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œå³å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ Web æµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚HTTP åè®®å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETE ç­‰ï¼‰ï¼Œç”¨äºæŒ‡å®šè¯·æ±‚çš„ç±»å‹å’Œç›®çš„ã€‚æ­¤å¤–ï¼ŒHTTP åè®®è¿˜å®šä¹‰äº†ä¸€ç»„çŠ¶æ€ä»£ç ï¼ˆå¦‚ 200ã€404ã€500 ç­‰ï¼‰ï¼Œç”¨äºè¡¨ç¤ºå“åº”çš„ç»“æœã€‚</p><p>HTTP åè®®ä¾èµ–äº TCP åè®®æ¥ä¼ è¾“æ•°æ®ã€‚å½“ Web æµè§ˆå™¨å‘ Web æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä½¿ç”¨ TCP åè®®ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚ä¸€æ—¦è¿æ¥å»ºç«‹ï¼ŒHTTP è¯·æ±‚æ¶ˆæ¯ä¼šè¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œç„¶åé€šè¿‡ TCP ä¿¡é“å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP è¯·æ±‚æ¶ˆæ¯ï¼Œå¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆ HTTP å“åº”æ¶ˆæ¯ã€‚æœ€åï¼ŒHTTP å“åº”æ¶ˆæ¯è¢«å°è£…åœ¨ TCP æ•°æ®åŒ…ä¸­ï¼Œå¹¶é€šè¿‡ç›¸åŒçš„ TCP ä¿¡é“å‘é€å›å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ° TCP æ•°æ®åŒ…åï¼Œè§£åŒ…æå– HTTP å“åº”æ¶ˆæ¯å¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚</p><img src="`+l+`"><p>è¿™å¹…å›¾å±•ç¤ºäº†å®¢æˆ·ç«¯ï¼ˆWeb æµè§ˆå™¨ï¼‰ä¸æœåŠ¡å™¨ï¼ˆWeb æœåŠ¡å™¨ï¼‰ä¹‹é—´çš„ HTTP è¯·æ±‚å’Œå“åº”ï¼Œå®ƒä»¬é€šè¿‡å¯é çš„ã€é¢å‘è¿æ¥çš„ TCP è¿æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><p>å¥½ï¼Œå†è¯´å› HTTP æœåŠ¡å™¨è¿™ä»¶äº‹ï¼Œæœ€éœ€è¦å…³æ³¨çš„æ— éä¸¤ç‚¹ï¼š</p><ul><li>è¯·æ±‚çš„æ•°æ®æ€ä¹ˆæŒ‰ç…§ HTTP åè®®è§£æå‡ºæ¥</li><li>å¦‚ä½•æŒ‰ç…§ HTTP åè®®ï¼Œè¿”å›æ•°æ®</li></ul><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦çŸ¥é“æ•°æ®æ ¼å¼çš„è§„èŒƒã€‚</p><p><strong>è¯·æ±‚æ¶ˆæ¯</strong></p><p>HTTP è¯·æ±‚æ¶ˆæ¯ç”±è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰ã€è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰ã€ç©ºè¡Œï¼ˆEmpty Lineï¼‰ã€è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼Œå¯é€‰ï¼‰å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚</p><p>â‘ ã€è¯·æ±‚è¡ŒåˆåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼ŒHTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ GET, POST, PUT, DELETE ç­‰ï¼‰ã€è¯·æ±‚çš„ç›®æ ‡ URLï¼ˆé€šå¸¸æ˜¯ç›¸å¯¹ URLï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹ URLï¼‰ã€HTTP ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ HTTP/1.1 æˆ– HTTP/2ï¼‰ï¼Œè¿™äº›éƒ¨åˆ†ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#f6f6f4;">GET /index.html HTTP/1.1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">GET /index.html HTTP/1.1</span></span></code></pre></div><p>â‘¡ã€è¯·æ±‚å¤´æ˜¯ä¸€ç³»åˆ—ä»¥é”®å€¼å¯¹è¡¨ç¤ºçš„å…ƒæ•°æ®ï¼Œç”¨äºæè¿°è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ã€‚æ¯ä¸ªè¯·æ±‚å¤´å ä¸€è¡Œï¼Œé”®å’Œå€¼ä¹‹é—´ç”¨å†’å·ï¼ˆ:ï¼‰åˆ†éš”ã€‚è¯·æ±‚å¤´åŒ…å«è¯¸å¦‚ Hostã€User-Agentã€Content-Typeã€Content-Lengthã€Accept ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#f6f6f4;">Host: www.tobebetterjavaer.com</span></span>
<span class="line"><span style="color:#f6f6f4;">User-Agent: Mozilla/5.0</span></span>
<span class="line"><span style="color:#f6f6f4;">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">Host: www.tobebetterjavaer.com</span></span>
<span class="line"><span style="color:#24292e;">User-Agent: Mozilla/5.0</span></span>
<span class="line"><span style="color:#24292e;">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span></code></pre></div><p>â‘¢ã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œè¡¨ç¤ºè¯·æ±‚å¤´çš„ç»“æŸã€‚</p><p>â‘£ã€å¯¹äºæŸäº› HTTP æ–¹æ³•ï¼ˆä¾‹å¦‚ POSTã€PUT ç­‰ï¼‰ï¼Œè¿˜å¯ä»¥åœ¨è¯·æ±‚æ¶ˆæ¯ä¸­åŒ…å«è¯·æ±‚ä½“ã€‚è¯·æ±‚ä½“ç”¨äºä¼ è¾“è¦å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚è¯·æ±‚ä½“çš„æ ¼å¼å’Œå†…å®¹å–å†³äº Content-Type è¯·æ±‚å¤´çš„å€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“æäº¤ HTML è¡¨å•æ—¶ï¼Œè¯·æ±‚ä½“å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#f6f6f4;">username=æ²‰é»˜ç‹äºŒ&amp;password=123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">username=æ²‰é»˜ç‹äºŒ&amp;password=123456</span></span></code></pre></div><p>å°†è¿™äº›éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œå°±æ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚æ¶ˆæ¯ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#f6f6f4;">POST /login HTTP/1.1</span></span>
<span class="line"><span style="color:#f6f6f4;">Host: Host: www.tobebetterjavaer.com</span></span>
<span class="line"><span style="color:#f6f6f4;">User-Agent: Mozilla/5.0</span></span>
<span class="line"><span style="color:#f6f6f4;">Content-Type: application/x-www-form-urlencoded</span></span>
<span class="line"><span style="color:#f6f6f4;">Content-Length: 29</span></span>
<span class="line"><span style="color:#f6f6f4;">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span>
<span class="line"><span style="color:#f6f6f4;"></span></span>
<span class="line"><span style="color:#f6f6f4;">username=æ²‰é»˜ç‹äºŒ&amp;password=123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">POST /login HTTP/1.1</span></span>
<span class="line"><span style="color:#24292e;">Host: Host: www.tobebetterjavaer.com</span></span>
<span class="line"><span style="color:#24292e;">User-Agent: Mozilla/5.0</span></span>
<span class="line"><span style="color:#24292e;">Content-Type: application/x-www-form-urlencoded</span></span>
<span class="line"><span style="color:#24292e;">Content-Length: 29</span></span>
<span class="line"><span style="color:#24292e;">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">username=æ²‰é»˜ç‹äºŒ&amp;password=123456</span></span></code></pre></div><p>æˆ‘ç”¨ä¸€å¼ æ€ç»´å¯¼å›¾æ¥è¡¨ç¤ºä¸‹ï¼š</p><img src="`+o+'"><p><strong>å“åº”æ¶ˆæ¯</strong></p><p>ä¸€ä¸ªå…¸å‹çš„ HTTP å“åº”æ¶ˆæ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰ã€å“åº”å¤´ï¼ˆResponse Headersï¼‰ã€å“åº”ä½“ï¼ˆResponse Bodyï¼‰ã€‚</p><img src="'+e+`"><p>ä¸Šé¢ä¸¤å¼ å›¾ï¼Œå¯ä»¥è®©ä½ å¯¹ HTTP è¯·æ±‚å’Œå“åº”æœ‰ä¸ªç›´è§‚æ˜ è±¡ï¼Œæ¥ä¸‹æ¥å¼€å§‹æŠ“é‡ç‚¹ã€‚</p><p>ä¸ç®¡æ˜¯è¯·æ±‚æ¶ˆæ¯è¿˜æ˜¯å“åº”æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œè¿™å°±ä¸ºæˆ‘ä»¬åé¢çš„å¤„ç†ç®€åŒ–äº†å¾ˆå¤šå·¥ä½œã€‚</p><ul><li>ç¬¬ä¸€è¡Œï¼šçŠ¶æ€è¡Œ</li><li>ç¬¬äºŒè¡Œåˆ°ç¬¬ä¸€ä¸ªç©ºè¡Œï¼šheaderï¼ˆè¯·æ±‚å¤´/ç›¸åº”å¤´ï¼‰</li><li>å‰©ä¸‹æ‰€æœ‰ï¼šæ­£æ–‡</li></ul><h4 id="_3-http-æœåŠ¡å™¨è®¾è®¡" tabindex="-1">3. HTTP æœåŠ¡å™¨è®¾è®¡ <a class="header-anchor" href="#_3-http-æœåŠ¡å™¨è®¾è®¡" aria-label="Permalink to &quot;3\\. HTTP æœåŠ¡å™¨è®¾è®¡&quot;">â€‹</a></h4><p>æ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼ŒåŸºäº Socket åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½¿ç”¨ Socket åŸºæœ¬æ²¡å•¥å¤ªå¤§çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å…³æ³¨ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œè§£æ</li><li>å°è£…è¿”å›ç»“æœ</li></ul><h5 id="a-è¯·æ±‚æ•°æ®è§£æ" tabindex="-1">a. è¯·æ±‚æ•°æ®è§£æ <a class="header-anchor" href="#a-è¯·æ±‚æ•°æ®è§£æ" aria-label="Permalink to &quot;a. è¯·æ±‚æ•°æ®è§£æ&quot;">â€‹</a></h5><p>æˆ‘ä»¬ä» Socket ä¸­æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åè§£æä¸ºå¯¹åº”çš„ HTTP è¯·æ±‚ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸ª Request å¯¹è±¡ï¼Œå†…éƒ¨ä¿å­˜ä¸€äº›åŸºæœ¬çš„ HTTP ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥é‡ç‚¹å°±æ˜¯å°† Socket ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æå‡ºæ¥ï¼Œå°è£…ä¸º request å¯¹è±¡ã€‚</p><blockquote><p>æ³¨æ„ğŸ“¢ï¼Œè¿™äº›ä»£ç æ”¾åœ¨ HttpMessageParser ç±»ä¸­ï¼Œéšåä¼šç»™å‡ºå®Œæ•´çš„ä»£ç ã€‚</p></blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Data</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">Request</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     * è¯·æ±‚æ–¹æ³• GET/POST/PUT/DELETE/OPTION...</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> method;</span></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     * è¯·æ±‚çš„uri</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> uri;</span></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     * HTTPç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> version;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     * è¯·æ±‚å¤´</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Map</span><span style="color:#F6F6F4;">&lt;String, String&gt; headers;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     * è¯·æ±‚å‚æ•°ç›¸å…³</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> message;</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Request</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * è¯·æ±‚æ–¹æ³• GET/POST/PUT/DELETE/OPTION...</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String method;</span></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * è¯·æ±‚çš„uri</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String uri;</span></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * HTTPç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String version;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * è¯·æ±‚å¤´</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; headers;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * è¯·æ±‚å‚æ•°ç›¸å…³</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String message;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>æ ¹æ®å‰é¢çš„ HTTP åè®®ä»‹ç»ï¼Œè§£æè¿‡ç¨‹å¦‚ä¸‹ï¼Œæˆ‘ä»¬å…ˆçœ‹è¯·æ±‚è¡Œçš„è§£æè¿‡ç¨‹ã€‚</p><p><strong>è¯·æ±‚è¡Œ</strong>ï¼ŒåŒ…å«ä¸‰ä¸ªåŸºæœ¬è¦ç´ ï¼šè¯·æ±‚æ–¹æ³• + URI + HTTP ç‰ˆæœ¬ï¼Œç”¨ç©ºæ ¼è¿›è¡Œåˆ†å‰²ï¼Œæ‰€ä»¥è§£æä»£ç å¦‚ä¸‹</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;"> * æ ¹æ®æ ‡å‡†çš„HTTPåè®®ï¼Œè§£æè¯·æ±‚è¡Œ</span></span>
<span class="line"><span style="color:#7B7F8B;"> *</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">reader</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">request</span></span>
<span class="line"><span style="color:#7B7F8B;"> */</span></span>
<span class="line"><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">decodeRequestLine</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">BufferedReader</span><span style="color:#F6F6F4;"> reader, </span><span style="color:#97E1F1;font-style:italic;">Request</span><span style="color:#F6F6F4;"> request) throws IOException {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;">[] strs </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> StringUtils.</span><span style="color:#62E884;">split</span><span style="color:#F6F6F4;">(reader.</span><span style="color:#62E884;">readLine</span><span style="color:#F6F6F4;">(), </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">assert</span><span style="color:#F6F6F4;"> strs.length </span><span style="color:#F286C4;">==</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">3</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"><span style="color:#F6F6F4;">    request.</span><span style="color:#62E884;">setMethod</span><span style="color:#F6F6F4;">(strs[</span><span style="color:#BF9EEE;">0</span><span style="color:#F6F6F4;">]);</span></span>
<span class="line"><span style="color:#F6F6F4;">    request.</span><span style="color:#62E884;">setUri</span><span style="color:#F6F6F4;">(strs[</span><span style="color:#BF9EEE;">1</span><span style="color:#F6F6F4;">]);</span></span>
<span class="line"><span style="color:#F6F6F4;">    request.</span><span style="color:#62E884;">setVersion</span><span style="color:#F6F6F4;">(strs[</span><span style="color:#BF9EEE;">2</span><span style="color:#F6F6F4;">]);</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * æ ¹æ®æ ‡å‡†çš„HTTPåè®®ï¼Œè§£æè¯·æ±‚è¡Œ</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">reader</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">request</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">decodeRequestLine</span><span style="color:#24292E;">(BufferedReader reader, Request request) throws IOException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] strs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> StringUtils.</span><span style="color:#6F42C1;">split</span><span style="color:#24292E;">(reader.</span><span style="color:#6F42C1;">readLine</span><span style="color:#24292E;">(), </span><span style="color:#032F62;">&quot; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">assert</span><span style="color:#24292E;"> strs.length </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    request.</span><span style="color:#6F42C1;">setMethod</span><span style="color:#24292E;">(strs[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">    request.</span><span style="color:#6F42C1;">setUri</span><span style="color:#24292E;">(strs[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">    request.</span><span style="color:#6F42C1;">setVersion</span><span style="color:#24292E;">(strs[</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><strong>è¯·æ±‚å¤´çš„è§£æ</strong>ï¼Œä»ç¬¬äºŒè¡Œï¼Œåˆ°ç¬¬ä¸€ä¸ªç©ºç™½è¡Œä¹‹é—´çš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½æ˜¯è¯·æ±‚å¤´ï¼›è¯·æ±‚å¤´çš„æ ¼å¼ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œå½¢å¦‚ <code>key:value</code>, å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">    * æ ¹æ®æ ‡å‡† HTTP åè®®ï¼Œè§£æè¯·æ±‚å¤´</span></span>
<span class="line"><span style="color:#7B7F8B;">    *</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">reader</span><span style="color:#7B7F8B;">  è¯»å–è¯·æ±‚å¤´çš„ BufferedReader å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">request</span><span style="color:#7B7F8B;"> å­˜å‚¨è¯·æ±‚ä¿¡æ¯çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@throws</span><span style="color:#7B7F8B;"> </span><span style="color:#97E1F1;">IOException</span><span style="color:#7B7F8B;"> å½“è¯»å–è¯·æ±‚å¤´ä¿¡æ¯æ—¶å‘ç”Ÿ I/O å¼‚å¸¸æ—¶ï¼Œå°†æŠ›å‡ºè¯¥å¼‚å¸¸</span></span>
<span class="line"><span style="color:#7B7F8B;">    */</span></span>
<span class="line"><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">decodeRequestHeader</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">BufferedReader</span><span style="color:#F6F6F4;"> reader, </span><span style="color:#97E1F1;font-style:italic;">Request</span><span style="color:#F6F6F4;"> request) throws IOException {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// åˆ›å»ºä¸€ä¸ª Map å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è¯·æ±‚å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">Map</span><span style="color:#F6F6F4;">&lt;String, String&gt; headers </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">HashMap</span><span style="color:#F6F6F4;">&lt;&gt;(</span><span style="color:#BF9EEE;">16</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è¯»å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä»¥ç©ºè¡Œç»“æŸ</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> line </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> reader.</span><span style="color:#62E884;">readLine</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;">[] kv;</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">while</span><span style="color:#F6F6F4;"> (</span><span style="color:#F286C4;">!</span><span style="color:#DEE492;">&quot;&quot;</span><span style="color:#F6F6F4;">.</span><span style="color:#62E884;">equals</span><span style="color:#F6F6F4;">(line)) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// å°†æ¯è¡Œè¯·æ±‚å¤´ä¿¡æ¯æŒ‰å†’å·åˆ†éš”ï¼Œåˆ†åˆ«ä½œä¸ºé”®å’Œå€¼å­˜å…¥ Map ä¸­</span></span>
<span class="line"><span style="color:#F6F6F4;">        kv </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> StringUtils.</span><span style="color:#62E884;">split</span><span style="color:#F6F6F4;">(line, </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">:</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">assert</span><span style="color:#F6F6F4;"> kv.length </span><span style="color:#F286C4;">==</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">2</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"><span style="color:#F6F6F4;">        headers.</span><span style="color:#62E884;">put</span><span style="color:#F6F6F4;">(kv[</span><span style="color:#BF9EEE;">0</span><span style="color:#F6F6F4;">].</span><span style="color:#62E884;">trim</span><span style="color:#F6F6F4;">(), kv[</span><span style="color:#BF9EEE;">1</span><span style="color:#F6F6F4;">].</span><span style="color:#62E884;">trim</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">        line </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> reader.</span><span style="color:#62E884;">readLine</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// å°†è§£æå‡ºæ¥çš„è¯·æ±‚å¤´ä¿¡æ¯å­˜å…¥ Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#F6F6F4;">    request.</span><span style="color:#62E884;">setHeaders</span><span style="color:#F6F6F4;">(headers);</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">    * æ ¹æ®æ ‡å‡† HTTP åè®®ï¼Œè§£æè¯·æ±‚å¤´</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">reader</span><span style="color:#6A737D;">  è¯»å–è¯·æ±‚å¤´çš„ BufferedReader å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">request</span><span style="color:#6A737D;"> å­˜å‚¨è¯·æ±‚ä¿¡æ¯çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@throws</span><span style="color:#6A737D;"> </span><span style="color:#6F42C1;">IOException</span><span style="color:#6A737D;"> å½“è¯»å–è¯·æ±‚å¤´ä¿¡æ¯æ—¶å‘ç”Ÿ I/O å¼‚å¸¸æ—¶ï¼Œå°†æŠ›å‡ºè¯¥å¼‚å¸¸</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">decodeRequestHeader</span><span style="color:#24292E;">(BufferedReader reader, Request request) throws IOException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// åˆ›å»ºä¸€ä¸ª Map å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨è¯·æ±‚å¤´ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">    Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; headers </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> HashMap&lt;&gt;(</span><span style="color:#005CC5;">16</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è¯»å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä»¥ç©ºè¡Œç»“æŸ</span></span>
<span class="line"><span style="color:#24292E;">    String line </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> reader.</span><span style="color:#6F42C1;">readLine</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] kv;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">equals</span><span style="color:#24292E;">(line)) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// å°†æ¯è¡Œè¯·æ±‚å¤´ä¿¡æ¯æŒ‰å†’å·åˆ†éš”ï¼Œåˆ†åˆ«ä½œä¸ºé”®å’Œå€¼å­˜å…¥ Map ä¸­</span></span>
<span class="line"><span style="color:#24292E;">        kv </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> StringUtils.</span><span style="color:#6F42C1;">split</span><span style="color:#24292E;">(line, </span><span style="color:#032F62;">&quot;:&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">assert</span><span style="color:#24292E;"> kv.length </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        headers.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(kv[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">].</span><span style="color:#6F42C1;">trim</span><span style="color:#24292E;">(), kv[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">].</span><span style="color:#6F42C1;">trim</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        line </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> reader.</span><span style="color:#6F42C1;">readLine</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// å°†è§£æå‡ºæ¥çš„è¯·æ±‚å¤´ä¿¡æ¯å­˜å…¥ Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#24292E;">    request.</span><span style="color:#6F42C1;">setHeaders</span><span style="color:#24292E;">(headers);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><strong>æœ€åå°±æ˜¯æ­£æ–‡çš„è§£æäº†</strong>ï¼Œè¿™ä¸€å—éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œæ­£æ–‡å¯èƒ½ä¸ºç©ºï¼Œä¹Ÿå¯èƒ½æœ‰æ•°æ®ï¼›æœ‰æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è¦å¦‚ä½•æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½å–å‡ºæ¥å‘¢ï¼Ÿ</p><p>å…ˆçœ‹å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;"> * æ ¹æ®æ ‡æ³¨HTTPåè®®ï¼Œè§£ææ­£æ–‡</span></span>
<span class="line"><span style="color:#7B7F8B;"> *</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">reader</span><span style="color:#7B7F8B;">    è¾“å…¥æµè¯»å–å™¨ï¼Œç”¨äºè¯»å–è¯·æ±‚ä¸­çš„æ•°æ®</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">request</span><span style="color:#7B7F8B;">   Request å¯¹è±¡ï¼Œè¡¨ç¤º HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@throws</span><span style="color:#7B7F8B;"> </span><span style="color:#97E1F1;">IOException</span><span style="color:#7B7F8B;"> å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º</span></span>
<span class="line"><span style="color:#7B7F8B;"> */</span></span>
<span class="line"><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">decodeRequestMessage</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">BufferedReader</span><span style="color:#F6F6F4;"> reader, </span><span style="color:#97E1F1;font-style:italic;">Request</span><span style="color:#F6F6F4;"> request) throws IOException {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ä»è¯·æ±‚å¤´ä¸­è·å– Content-Lengthï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä¸º 0</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">int</span><span style="color:#F6F6F4;"> contentLen </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> Integer.</span><span style="color:#62E884;">parseInt</span><span style="color:#F6F6F4;">(request.</span><span style="color:#62E884;">getHeaders</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">getOrDefault</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">Content-Length</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">0</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// å¦‚æœ Content-Length ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰è¯·æ±‚æ­£æ–‡ï¼Œç›´æ¥è¿”å›ã€‚</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ä¾‹å¦‚ GET å’Œ OPTIONS è¯·æ±‚é€šå¸¸ä¸åŒ…å«è¯·æ±‚æ­£æ–‡</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (contentLen </span><span style="color:#F286C4;">==</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">0</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// æ ¹æ® Content-Length åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„æ¥å­˜å‚¨è¯·æ±‚æ­£æ–‡</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">char</span><span style="color:#F6F6F4;">[] message </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">char</span><span style="color:#F6F6F4;">[contentLen];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ä½¿ç”¨ BufferedReader è¯»å–è¯·æ±‚æ­£æ–‡</span></span>
<span class="line"><span style="color:#F6F6F4;">    reader.</span><span style="color:#62E884;">read</span><span style="color:#F6F6F4;">(message);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// å°†å­—ç¬¦æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º Request å¯¹è±¡çš„ message</span></span>
<span class="line"><span style="color:#F6F6F4;">    request.</span><span style="color:#62E884;">setMessage</span><span style="color:#F6F6F4;">(</span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">String</span><span style="color:#F6F6F4;">(message));</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * æ ¹æ®æ ‡æ³¨HTTPåè®®ï¼Œè§£ææ­£æ–‡</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">reader</span><span style="color:#6A737D;">    è¾“å…¥æµè¯»å–å™¨ï¼Œç”¨äºè¯»å–è¯·æ±‚ä¸­çš„æ•°æ®</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">request</span><span style="color:#6A737D;">   Request å¯¹è±¡ï¼Œè¡¨ç¤º HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@throws</span><span style="color:#6A737D;"> </span><span style="color:#6F42C1;">IOException</span><span style="color:#6A737D;"> å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">decodeRequestMessage</span><span style="color:#24292E;">(BufferedReader reader, Request request) throws IOException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ä»è¯·æ±‚å¤´ä¸­è·å– Content-Lengthï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä¸º 0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> contentLen </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Integer.</span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(request.</span><span style="color:#6F42C1;">getHeaders</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getOrDefault</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Content-Length&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;0&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// å¦‚æœ Content-Length ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰è¯·æ±‚æ­£æ–‡ï¼Œç›´æ¥è¿”å›ã€‚</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ä¾‹å¦‚ GET å’Œ OPTIONS è¯·æ±‚é€šå¸¸ä¸åŒ…å«è¯·æ±‚æ­£æ–‡</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (contentLen </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// æ ¹æ® Content-Length åˆ›å»ºä¸€ä¸ªå­—ç¬¦æ•°ç»„æ¥å­˜å‚¨è¯·æ±‚æ­£æ–‡</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">char</span><span style="color:#24292E;">[] message </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">char</span><span style="color:#24292E;">[contentLen];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ä½¿ç”¨ BufferedReader è¯»å–è¯·æ±‚æ­£æ–‡</span></span>
<span class="line"><span style="color:#24292E;">    reader.</span><span style="color:#6F42C1;">read</span><span style="color:#24292E;">(message);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// å°†å­—ç¬¦æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º Request å¯¹è±¡çš„ message</span></span>
<span class="line"><span style="color:#24292E;">    request.</span><span style="color:#6F42C1;">setMessage</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">String</span><span style="color:#24292E;">(message));</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>æ³¨æ„ä¸Šé¢æˆ‘çš„ä½¿ç”¨å§¿åŠ¿ï¼Œé¦–å…ˆæ˜¯æ ¹æ®è¯·æ±‚å¤´ä¸­çš„<code>Content-Type</code>çš„å€¼ï¼Œæ¥è·å¾—æ­£æ–‡çš„æ•°æ®å¤§å°ï¼Œå› æ­¤æˆ‘ä»¬è·å–çš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªè¿™ä¹ˆå¤§çš„<code>char[]</code> æ•°ç»„æ¥è¯»å–æµä¸­æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°ç»„æ¯”å®é™…çš„å°ï¼Œåˆ™è¯»ä¸å®Œï¼›å¦‚æœå¤§ï¼Œåˆ™æ•°ç»„ä¸­ä¼šæœ‰ä¸€äº›ç©ºçš„æ•°æ®ï¼›</p><p><strong>æœ€åå°†ä¸Šé¢çš„å‡ ä¸ªè§£æå°è£…ä¸€ä¸‹</strong>ï¼Œå®Œæˆ request è§£æï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;"> * HTTP è¯·æ±‚å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</span></span>
<span class="line"><span style="color:#7B7F8B;"> * 1. è¯·æ±‚è¡Œï¼šåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€URI å’Œ HTTP åè®®ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#7B7F8B;"> * 2. è¯·æ±‚å¤´ï¼šä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œç›´åˆ°ä¸€ä¸ªç©ºè¡Œä¸ºæ­¢</span></span>
<span class="line"><span style="color:#7B7F8B;"> * 3. æ¶ˆæ¯æ­£æ–‡ï¼šç´§è·Ÿåœ¨ç©ºè¡Œåçš„æ‰€æœ‰å†…å®¹ï¼Œé•¿åº¦ç”±è¯·æ±‚å¤´ä¸­çš„ Content-Length å†³å®š</span></span>
<span class="line"><span style="color:#7B7F8B;"> *</span></span>
<span class="line"><span style="color:#7B7F8B;"> * æœ¬æ–¹æ³•å°† InputStream ä¸­çš„ HTTP è¯·æ±‚æ•°æ®è§£æä¸ºä¸€ä¸ª Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;"> *</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">reqStream</span><span style="color:#7B7F8B;">  åŒ…å« HTTP è¯·æ±‚æ•°æ®çš„è¾“å…¥æµ</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@return</span><span style="color:#7B7F8B;">           ä¸€ä¸ªè¡¨ç¤º HTTP è¯·æ±‚çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;"> * </span><span style="color:#F286C4;">@throws</span><span style="color:#7B7F8B;"> </span><span style="color:#97E1F1;">IOException</span><span style="color:#7B7F8B;"> å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º</span></span>
<span class="line"><span style="color:#7B7F8B;"> */</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Request</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">parse2request</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">InputStream</span><span style="color:#F6F6F4;"> reqStream) throws IOException {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ä½¿ç”¨ BufferedReader å’Œ InputStreamReader è¯»å–è¾“å…¥æµä¸­çš„æ•°æ®</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">BufferedReader</span><span style="color:#F6F6F4;"> httpReader </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">BufferedReader</span><span style="color:#F6F6F4;">(</span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">InputStreamReader</span><span style="color:#F6F6F4;">(reqStream, </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">UTF-8</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">Request</span><span style="color:#F6F6F4;"> httpRequest </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">Request</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è§£æè¯·æ±‚è¡Œå¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">decodeRequestLine</span><span style="color:#F6F6F4;">(httpReader, httpRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è§£æè¯·æ±‚å¤´å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">decodeRequestHeader</span><span style="color:#F6F6F4;">(httpReader, httpRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è§£ææ¶ˆæ¯æ­£æ–‡å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">decodeRequestMessage</span><span style="color:#F6F6F4;">(httpReader, httpRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è¿”å›è§£æåçš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> httpRequest;</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * HTTP è¯·æ±‚å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</span></span>
<span class="line"><span style="color:#6A737D;"> * 1. è¯·æ±‚è¡Œï¼šåŒ…æ‹¬è¯·æ±‚æ–¹æ³•ã€URI å’Œ HTTP åè®®ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#6A737D;"> * 2. è¯·æ±‚å¤´ï¼šä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œç›´åˆ°ä¸€ä¸ªç©ºè¡Œä¸ºæ­¢</span></span>
<span class="line"><span style="color:#6A737D;"> * 3. æ¶ˆæ¯æ­£æ–‡ï¼šç´§è·Ÿåœ¨ç©ºè¡Œåçš„æ‰€æœ‰å†…å®¹ï¼Œé•¿åº¦ç”±è¯·æ±‚å¤´ä¸­çš„ Content-Length å†³å®š</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * æœ¬æ–¹æ³•å°† InputStream ä¸­çš„ HTTP è¯·æ±‚æ•°æ®è§£æä¸ºä¸€ä¸ª Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;"> *</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">reqStream</span><span style="color:#6A737D;">  åŒ…å« HTTP è¯·æ±‚æ•°æ®çš„è¾“å…¥æµ</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@return</span><span style="color:#6A737D;">           ä¸€ä¸ªè¡¨ç¤º HTTP è¯·æ±‚çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#D73A49;">@throws</span><span style="color:#6A737D;"> </span><span style="color:#6F42C1;">IOException</span><span style="color:#6A737D;"> å½“å‘ç”Ÿ I/O é”™è¯¯æ—¶æŠ›å‡º</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> Request </span><span style="color:#6F42C1;">parse2request</span><span style="color:#24292E;">(InputStream reqStream) throws IOException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ä½¿ç”¨ BufferedReader å’Œ InputStreamReader è¯»å–è¾“å…¥æµä¸­çš„æ•°æ®</span></span>
<span class="line"><span style="color:#24292E;">    BufferedReader httpReader </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BufferedReader</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InputStreamReader</span><span style="color:#24292E;">(reqStream, </span><span style="color:#032F62;">&quot;UTF-8&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#24292E;">    Request httpRequest </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Request</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è§£æè¯·æ±‚è¡Œå¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">decodeRequestLine</span><span style="color:#24292E;">(httpReader, httpRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è§£æè¯·æ±‚å¤´å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">decodeRequestHeader</span><span style="color:#24292E;">(httpReader, httpRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è§£ææ¶ˆæ¯æ­£æ–‡å¹¶è®¾ç½®åˆ° Request å¯¹è±¡ä¸­</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">decodeRequestMessage</span><span style="color:#24292E;">(httpReader, httpRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è¿”å›è§£æåçš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> httpRequest;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæ˜¯è¯·æ±‚ç»“æœçš„å°è£…ï¼Œç»™ä¸€ä¸ªç®€å•çš„è¿›è¡Œæ¼”ç¤ºï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">    * Response ç±»è¡¨ç¤ºä¸€ä¸ª HTTP å“åº”ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å“åº”å¤´å’Œå“åº”æ­£æ–‡ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;">    */</span></span>
<span class="line"><span style="color:#F6F6F4;">@</span><span style="color:#97E1F1;font-style:italic;">Data</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">Response</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> version;</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">int</span><span style="color:#F6F6F4;"> code;</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> status;</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Map</span><span style="color:#F6F6F4;">&lt;String, String&gt; headers;</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> message;</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">    * æ ¹æ®ç»™å®šçš„ Request å¯¹è±¡å’Œå“åº”å­—ç¬¦ä¸²æ„å»ºä¸€ä¸ª HTTP å“åº”ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;">    *</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">request</span><span style="color:#7B7F8B;">   ç”¨äºæ„å»ºå“åº”çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">response</span><span style="color:#7B7F8B;">  å“åº”å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@return</span><span style="color:#7B7F8B;">          ä¸€ä¸ªè¡¨ç¤º HTTP å“åº”çš„å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#7B7F8B;">    */</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">buildResponse</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">Request</span><span style="color:#F6F6F4;"> request, </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> response) {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Response å¯¹è±¡ï¼Œå¹¶è®¾ç½®ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">Response</span><span style="color:#F6F6F4;"> httpResponse </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">Response</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    httpResponse.</span><span style="color:#62E884;">setCode</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">200</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">    httpResponse.</span><span style="color:#62E884;">setStatus</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">ok</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">    httpResponse.</span><span style="color:#62E884;">setVersion</span><span style="color:#F6F6F4;">(request.</span><span style="color:#62E884;">getVersion</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è®¾ç½®å“åº”å¤´</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">Map</span><span style="color:#F6F6F4;">&lt;String, String&gt; headers </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">HashMap</span><span style="color:#F6F6F4;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#F6F6F4;">    headers.</span><span style="color:#62E884;">put</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">Content-Type</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, </span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">application/json</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">    headers.</span><span style="color:#62E884;">put</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">Content-Length</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">, String.</span><span style="color:#62E884;">valueOf</span><span style="color:#F6F6F4;">(response.</span><span style="color:#62E884;">getBytes</span><span style="color:#F6F6F4;">().length));</span></span>
<span class="line"><span style="color:#F6F6F4;">    httpResponse.</span><span style="color:#62E884;">setHeaders</span><span style="color:#F6F6F4;">(headers);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è®¾ç½®å“åº”æ­£æ–‡</span></span>
<span class="line"><span style="color:#F6F6F4;">    httpResponse.</span><span style="color:#62E884;">setMessage</span><span style="color:#F6F6F4;">(response);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// æ„å»ºå“åº”å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#97E1F1;font-style:italic;">StringBuilder</span><span style="color:#F6F6F4;"> builder </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">StringBuilder</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">buildResponseLine</span><span style="color:#F6F6F4;">(httpResponse, builder);</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">buildResponseHeaders</span><span style="color:#F6F6F4;">(httpResponse, builder);</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">buildResponseMessage</span><span style="color:#F6F6F4;">(httpResponse, builder);</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> builder.</span><span style="color:#62E884;">toString</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">    * æ„å»ºå“åº”è¡Œï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;">    *</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">response</span><span style="color:#7B7F8B;">      ç”¨äºæ„å»ºå“åº”è¡Œçš„ Response å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">stringBuilder</span><span style="color:#7B7F8B;"> ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    */</span></span>
<span class="line"><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">buildResponseLine</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">Response</span><span style="color:#F6F6F4;"> response, </span><span style="color:#97E1F1;font-style:italic;">StringBuilder</span><span style="color:#F6F6F4;"> stringBuilder) {</span></span>
<span class="line"><span style="color:#F6F6F4;">    stringBuilder.</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(response.</span><span style="color:#62E884;">getVersion</span><span style="color:#F6F6F4;">()).</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">).</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(response.</span><span style="color:#62E884;">getCode</span><span style="color:#F6F6F4;">()).</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;"> </span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">)</span></span>
<span class="line"><span style="color:#F6F6F4;">            .</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(response.</span><span style="color:#62E884;">getStatus</span><span style="color:#F6F6F4;">()).</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#F286C4;">\\n</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">    * æ„å»ºå“åº”å¤´ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;">    *</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">response</span><span style="color:#7B7F8B;">      ç”¨äºæ„å»ºå“åº”å¤´çš„ Response å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">stringBuilder</span><span style="color:#7B7F8B;"> ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    */</span></span>
<span class="line"><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">buildResponseHeaders</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">Response</span><span style="color:#F6F6F4;"> response, </span><span style="color:#97E1F1;font-style:italic;">StringBuilder</span><span style="color:#F6F6F4;"> stringBuilder) {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">for</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">Map</span><span style="color:#F6F6F4;">.</span><span style="color:#97E1F1;font-style:italic;">Entry</span><span style="color:#F6F6F4;">&lt;String, String&gt; entry </span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> response.</span><span style="color:#62E884;">getHeaders</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">entrySet</span><span style="color:#F6F6F4;">()) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        stringBuilder.</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(entry.</span><span style="color:#62E884;">getKey</span><span style="color:#F6F6F4;">()).</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">:</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">).</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(entry.</span><span style="color:#62E884;">getValue</span><span style="color:#F6F6F4;">()).</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#F286C4;">\\n</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">    stringBuilder.</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#F286C4;">\\n</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">    * æ„å»ºå“åº”æ­£æ–‡ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;">    *</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">response</span><span style="color:#7B7F8B;">      ç”¨äºæ„å»ºå“åº”æ­£æ–‡çš„ Response å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">stringBuilder</span><span style="color:#7B7F8B;"> ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span>
<span class="line"><span style="color:#7B7F8B;">    */</span></span>
<span class="line"><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">buildResponseMessage</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">Response</span><span style="color:#F6F6F4;"> response, </span><span style="color:#97E1F1;font-style:italic;">StringBuilder</span><span style="color:#F6F6F4;"> stringBuilder) {</span></span>
<span class="line"><span style="color:#F6F6F4;">    stringBuilder.</span><span style="color:#62E884;">append</span><span style="color:#F6F6F4;">(response.</span><span style="color:#62E884;">getMessage</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">    * Response ç±»è¡¨ç¤ºä¸€ä¸ª HTTP å“åº”ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å“åº”å¤´å’Œå“åº”æ­£æ–‡ã€‚</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Data</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Response</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String version;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> code;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String status;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; headers;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> String message;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">    * æ ¹æ®ç»™å®šçš„ Request å¯¹è±¡å’Œå“åº”å­—ç¬¦ä¸²æ„å»ºä¸€ä¸ª HTTP å“åº”ã€‚</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">request</span><span style="color:#6A737D;">   ç”¨äºæ„å»ºå“åº”çš„ Request å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">response</span><span style="color:#6A737D;">  å“åº”å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@return</span><span style="color:#6A737D;">          ä¸€ä¸ªè¡¨ç¤º HTTP å“åº”çš„å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> String </span><span style="color:#6F42C1;">buildResponse</span><span style="color:#24292E;">(Request request, String response) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Response å¯¹è±¡ï¼Œå¹¶è®¾ç½®ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">    Response httpResponse </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Response</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    httpResponse.</span><span style="color:#6F42C1;">setCode</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">200</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    httpResponse.</span><span style="color:#6F42C1;">setStatus</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ok&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    httpResponse.</span><span style="color:#6F42C1;">setVersion</span><span style="color:#24292E;">(request.</span><span style="color:#6F42C1;">getVersion</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è®¾ç½®å“åº”å¤´</span></span>
<span class="line"><span style="color:#24292E;">    Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; headers </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="color:#24292E;">    headers.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Content-Type&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;application/json&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    headers.</span><span style="color:#6F42C1;">put</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Content-Length&quot;</span><span style="color:#24292E;">, String.</span><span style="color:#6F42C1;">valueOf</span><span style="color:#24292E;">(response.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">().length));</span></span>
<span class="line"><span style="color:#24292E;">    httpResponse.</span><span style="color:#6F42C1;">setHeaders</span><span style="color:#24292E;">(headers);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è®¾ç½®å“åº”æ­£æ–‡</span></span>
<span class="line"><span style="color:#24292E;">    httpResponse.</span><span style="color:#6F42C1;">setMessage</span><span style="color:#24292E;">(response);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// æ„å»ºå“åº”å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#24292E;">    StringBuilder builder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">StringBuilder</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">buildResponseLine</span><span style="color:#24292E;">(httpResponse, builder);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">buildResponseHeaders</span><span style="color:#24292E;">(httpResponse, builder);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">buildResponseMessage</span><span style="color:#24292E;">(httpResponse, builder);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> builder.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">    * æ„å»ºå“åº”è¡Œï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯ã€‚</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">response</span><span style="color:#6A737D;">      ç”¨äºæ„å»ºå“åº”è¡Œçš„ Response å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">stringBuilder</span><span style="color:#6A737D;"> ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">buildResponseLine</span><span style="color:#24292E;">(Response response, StringBuilder stringBuilder) {</span></span>
<span class="line"><span style="color:#24292E;">    stringBuilder.</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(response.</span><span style="color:#6F42C1;">getVersion</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; &quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(response.</span><span style="color:#6F42C1;">getCode</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; &quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            .</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(response.</span><span style="color:#6F42C1;">getStatus</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">    * æ„å»ºå“åº”å¤´ã€‚</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">response</span><span style="color:#6A737D;">      ç”¨äºæ„å»ºå“åº”å¤´çš„ Response å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">stringBuilder</span><span style="color:#6A737D;"> ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">buildResponseHeaders</span><span style="color:#24292E;">(Response response, StringBuilder stringBuilder) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (Map.Entry&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; entry </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> response.</span><span style="color:#6F42C1;">getHeaders</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">entrySet</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">        stringBuilder.</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(entry.</span><span style="color:#6F42C1;">getKey</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;:&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(entry.</span><span style="color:#6F42C1;">getValue</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    stringBuilder.</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">    * æ„å»ºå“åº”æ­£æ–‡ã€‚</span></span>
<span class="line"><span style="color:#6A737D;">    *</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">response</span><span style="color:#6A737D;">      ç”¨äºæ„å»ºå“åº”æ­£æ–‡çš„ Response å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">stringBuilder</span><span style="color:#6A737D;"> ç”¨äºæ‹¼æ¥å“åº”å­—ç¬¦ä¸²çš„ StringBuilder å¯¹è±¡</span></span>
<span class="line"><span style="color:#6A737D;">    */</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">buildResponseMessage</span><span style="color:#24292E;">(Response response, StringBuilder stringBuilder) {</span></span>
<span class="line"><span style="color:#24292E;">    stringBuilder.</span><span style="color:#6F42C1;">append</span><span style="color:#24292E;">(response.</span><span style="color:#6F42C1;">getMessage</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h5 id="b-è¯·æ±‚ä»»åŠ¡-httptask" tabindex="-1">b. è¯·æ±‚ä»»åŠ¡ HttpTask <a class="header-anchor" href="#b-è¯·æ±‚ä»»åŠ¡-httptask" aria-label="Permalink to &quot;b. è¯·æ±‚ä»»åŠ¡ HttpTask&quot;">â€‹</a></h5><p>æ¯ä¸ªè¯·æ±‚ï¼Œå•ç‹¬åˆ†é…ä¸€ä¸ªä»»åŠ¡æ¥å¹²è¿™ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯ä¸ºäº†æ”¯æŒå¹¶å‘ï¼Œå¯¹äº ServerSocket è€Œè¨€ï¼Œæ¥æ”¶åˆ°äº†ä¸€ä¸ªè¯·æ±‚ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ª HttpTask ä»»åŠ¡æ¥å®ç° HTTP é€šä¿¡ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ª httptask å¹²å•¥å‘¢ï¼Ÿ</p><ul><li>ä»è¯·æ±‚ä¸­ææ•°æ®</li><li>å“åº”è¯·æ±‚</li><li>å°è£…ç»“æœå¹¶è¿”å›</li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;"> * HttpTask ç±»å®ç°äº† Runnable æ¥å£ï¼Œç”¨äºå¤„ç†ä¸€ä¸ª HTTP è¯·æ±‚ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;"> * å½“åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ï¼Œè¯¥ä»»åŠ¡å°†å¤„ç†ä¸€ä¸ª Socket è¿æ¥ä¸Šçš„ HTTP è¯·æ±‚ï¼Œ</span></span>
<span class="line"><span style="color:#7B7F8B;"> * å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;"> */</span></span>
<span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">HttpTask</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">implements</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Runnable</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Socket</span><span style="color:#F6F6F4;"> socket;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     * æ„é€ ä¸€ä¸ªæ–°çš„ HttpTaskï¼Œç”¨äºå¤„ç†æŒ‡å®šçš„ Socket è¿æ¥ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;">     *</span></span>
<span class="line"><span style="color:#7B7F8B;">     * </span><span style="color:#F286C4;">@param</span><span style="color:#7B7F8B;"> </span><span style="color:#FFB86C;font-style:italic;">socket</span><span style="color:#7B7F8B;">  ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">HttpTask</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">Socket</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">socket</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#BF9EEE;font-style:italic;">this</span><span style="color:#F6F6F4;">.socket </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> socket;</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B7F8B;">    /**</span></span>
<span class="line"><span style="color:#7B7F8B;">     * å®ç° Runnable æ¥å£çš„ run æ–¹æ³•ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚</span></span>
<span class="line"><span style="color:#7B7F8B;">     */</span></span>
<span class="line"><span style="color:#F6F6F4;">    @</span><span style="color:#97E1F1;font-style:italic;">Override</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">run</span><span style="color:#F6F6F4;">() {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// æ£€æŸ¥ socket æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º null åˆ™æŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (socket </span><span style="color:#F286C4;">==</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">null</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">throw</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">IllegalArgumentException</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&quot;</span><span style="color:#E7EE98;">socket can&#39;t be null.</span><span style="color:#DEE492;">&quot;</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">try</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#7B7F8B;">// è·å– Socket çš„è¾“å‡ºæµï¼Œå¹¶åˆ›å»ºä¸€ä¸ª PrintWriter å¯¹è±¡</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;font-style:italic;">OutputStream</span><span style="color:#F6F6F4;"> outputStream </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> socket.</span><span style="color:#62E884;">getOutputStream</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;font-style:italic;">PrintWriter</span><span style="color:#F6F6F4;"> out </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">PrintWriter</span><span style="color:#F6F6F4;">(outputStream);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#7B7F8B;">// ä» Socket çš„è¾“å…¥æµä¸­è§£æ HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#97E1F1;font-style:italic;">HttpMessageParser</span><span style="color:#F6F6F4;">.</span><span style="color:#97E1F1;font-style:italic;">Request</span><span style="color:#F6F6F4;"> httpRequest </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> HttpMessageParser.</span><span style="color:#62E884;">parse2request</span><span style="color:#F6F6F4;">(socket.</span><span style="color:#62E884;">getInputStream</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">try</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#7B7F8B;">// æ ¹æ®è¯·æ±‚ç»“æœè¿›è¡Œå“åº”ï¼Œçœç•¥è¿”å›</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> result </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">null</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#7B7F8B;">// æ ¹æ®è¯·æ±‚å’Œç»“æœæ„å»º HTTP å“åº”</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> httpRes </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> HttpMessageParser.</span><span style="color:#62E884;">buildResponse</span><span style="color:#F6F6F4;">(httpRequest, result);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#7B7F8B;">// å°† HTTP å“åº”å‘é€åˆ°å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#F6F6F4;">                out.</span><span style="color:#62E884;">print</span><span style="color:#F6F6F4;">(httpRes);</span></span>
<span class="line"><span style="color:#F6F6F4;">            } </span><span style="color:#F286C4;">catch</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">Exception</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">e</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#7B7F8B;">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«å¼‚å¸¸ä¿¡æ¯çš„ HTTP å“åº”</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#97E1F1;font-style:italic;">String</span><span style="color:#F6F6F4;"> httpRes </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> HttpMessageParser.</span><span style="color:#62E884;">buildResponse</span><span style="color:#F6F6F4;">(httpRequest, e.</span><span style="color:#62E884;">toString</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"><span style="color:#F6F6F4;">                out.</span><span style="color:#62E884;">print</span><span style="color:#F6F6F4;">(httpRes);</span></span>
<span class="line"><span style="color:#F6F6F4;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#7B7F8B;">// åˆ·æ–°è¾“å‡ºæµï¼Œç¡®ä¿å“åº”æ¶ˆæ¯è¢«å‘é€</span></span>
<span class="line"><span style="color:#F6F6F4;">            out.</span><span style="color:#62E884;">flush</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">        } </span><span style="color:#F286C4;">catch</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">IOException</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">e</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            e.</span><span style="color:#62E884;">printStackTrace</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">        } </span><span style="color:#F286C4;">finally</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#7B7F8B;">// å…³é—­ Socket è¿æ¥</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">try</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">                socket.</span><span style="color:#62E884;">close</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">            } </span><span style="color:#F286C4;">catch</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">IOException</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">e</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                e.</span><span style="color:#62E884;">printStackTrace</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">            }</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * HttpTask ç±»å®ç°äº† Runnable æ¥å£ï¼Œç”¨äºå¤„ç†ä¸€ä¸ª HTTP è¯·æ±‚ã€‚</span></span>
<span class="line"><span style="color:#6A737D;"> * å½“åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ï¼Œè¯¥ä»»åŠ¡å°†å¤„ç†ä¸€ä¸ª Socket è¿æ¥ä¸Šçš„ HTTP è¯·æ±‚ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;"> * å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">HttpTask</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Runnable</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Socket socket;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * æ„é€ ä¸€ä¸ªæ–°çš„ HttpTaskï¼Œç”¨äºå¤„ç†æŒ‡å®šçš„ Socket è¿æ¥ã€‚</span></span>
<span class="line"><span style="color:#6A737D;">     *</span></span>
<span class="line"><span style="color:#6A737D;">     * </span><span style="color:#D73A49;">@param</span><span style="color:#6A737D;"> </span><span style="color:#E36209;">socket</span><span style="color:#6A737D;">  ç”¨äºå¤„ç† HTTP è¯·æ±‚çš„ Socket</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">HttpTask</span><span style="color:#24292E;">(Socket </span><span style="color:#E36209;">socket</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.socket </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> socket;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    /**</span></span>
<span class="line"><span style="color:#6A737D;">     * å®ç° Runnable æ¥å£çš„ run æ–¹æ³•ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚</span></span>
<span class="line"><span style="color:#6A737D;">     */</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// æ£€æŸ¥ socket æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º null åˆ™æŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (socket </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IllegalArgumentException</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;socket can&#39;t be null.&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// è·å– Socket çš„è¾“å‡ºæµï¼Œå¹¶åˆ›å»ºä¸€ä¸ª PrintWriter å¯¹è±¡</span></span>
<span class="line"><span style="color:#24292E;">            OutputStream outputStream </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> socket.</span><span style="color:#6F42C1;">getOutputStream</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            PrintWriter out </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PrintWriter</span><span style="color:#24292E;">(outputStream);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// ä» Socket çš„è¾“å…¥æµä¸­è§£æ HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#24292E;">            HttpMessageParser.Request httpRequest </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> HttpMessageParser.</span><span style="color:#6F42C1;">parse2request</span><span style="color:#24292E;">(socket.</span><span style="color:#6F42C1;">getInputStream</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// æ ¹æ®è¯·æ±‚ç»“æœè¿›è¡Œå“åº”ï¼Œçœç•¥è¿”å›</span></span>
<span class="line"><span style="color:#24292E;">                String result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                </span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// æ ¹æ®è¯·æ±‚å’Œç»“æœæ„å»º HTTP å“åº”</span></span>
<span class="line"><span style="color:#24292E;">                String httpRes </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> HttpMessageParser.</span><span style="color:#6F42C1;">buildResponse</span><span style="color:#24292E;">(httpRequest, result);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// å°† HTTP å“åº”å‘é€åˆ°å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="color:#24292E;">                out.</span><span style="color:#6F42C1;">print</span><span style="color:#24292E;">(httpRes);</span></span>
<span class="line"><span style="color:#24292E;">            } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«å¼‚å¸¸ä¿¡æ¯çš„ HTTP å“åº”</span></span>
<span class="line"><span style="color:#24292E;">                String httpRes </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> HttpMessageParser.</span><span style="color:#6F42C1;">buildResponse</span><span style="color:#24292E;">(httpRequest, e.</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">                out.</span><span style="color:#6F42C1;">print</span><span style="color:#24292E;">(httpRes);</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// åˆ·æ–°è¾“å‡ºæµï¼Œç¡®ä¿å“åº”æ¶ˆæ¯è¢«å‘é€</span></span>
<span class="line"><span style="color:#24292E;">            out.</span><span style="color:#6F42C1;">flush</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (IOException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// å…³é—­ Socket è¿æ¥</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                socket.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (IOException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h5 id="c-http-æœåŠ¡æ­å»º" tabindex="-1">c. HTTP æœåŠ¡æ­å»º <a class="header-anchor" href="#c-http-æœåŠ¡æ­å»º" aria-label="Permalink to &quot;c. HTTP æœåŠ¡æ­å»º&quot;">â€‹</a></h5><p>å‰é¢çš„åŸºæœ¬ä¸ŠæŠŠè¯¥å¹²çš„äº‹æƒ…éƒ½å¹²äº†ï¼Œå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œåˆ›å»º<code>ServerSocket</code>ï¼Œç»‘å®šç«¯å£æ¥æ”¶è¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨çº¿ç¨‹æ± ä¸­è·‘è¿™ä¸ª HTTP æœåŠ¡</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki dracula-soft vp-code-dark"><code><span class="line"><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">BasicHttpServer</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼Œç”¨äºå¯åŠ¨ HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ExecutorService</span><span style="color:#F6F6F4;"> bootstrapExecutor </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> Executors.</span><span style="color:#62E884;">newSingleThreadExecutor</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ExecutorService</span><span style="color:#F6F6F4;"> taskExecutor;</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">int</span><span style="color:#F6F6F4;"> PORT </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">8999</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// å¯åŠ¨ HTTP æœåŠ¡å™¨çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">startHttpServer</span><span style="color:#F6F6F4;">() {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// è·å–å¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œç”¨äºè®¾ç½®çº¿ç¨‹æ± å¤§å°</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#97E1F1;font-style:italic;">int</span><span style="color:#F6F6F4;"> nThreads </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> Runtime.</span><span style="color:#62E884;">getRuntime</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">availableProcessors</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// åˆå§‹åŒ–çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼Œé˜Ÿåˆ—å¤§å°å’Œä¸¢å¼ƒç­–ç•¥</span></span>
<span class="line"><span style="color:#F6F6F4;">        taskExecutor </span><span style="color:#F286C4;">=</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ThreadPoolExecutor</span><span style="color:#F6F6F4;">(nThreads, nThreads, </span><span style="color:#BF9EEE;">0L</span><span style="color:#F6F6F4;">, TimeUnit.MILLISECONDS, </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">LinkedBlockingQueue</span><span style="color:#F6F6F4;">&lt;&gt;(</span><span style="color:#BF9EEE;">100</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">                        </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> ThreadPoolExecutor.</span><span style="color:#62E884;">DiscardPolicy</span><span style="color:#F6F6F4;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// å¾ªç¯å°è¯•å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™ç­‰å¾…10ç§’åé‡è¯•</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">while</span><span style="color:#F6F6F4;"> (</span><span style="color:#BF9EEE;">true</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">try</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#97E1F1;font-style:italic;">ServerSocket</span><span style="color:#F6F6F4;"> serverSocket </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ServerSocket</span><span style="color:#F6F6F4;">(PORT);</span></span>
<span class="line"><span style="color:#F6F6F4;">                bootstrapExecutor.</span><span style="color:#62E884;">submit</span><span style="color:#F6F6F4;">(</span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ServerThread</span><span style="color:#F6F6F4;">(serverSocket));</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#F286C4;">break</span><span style="color:#F6F6F4;">;</span></span>
<span class="line"><span style="color:#F6F6F4;">            } </span><span style="color:#F286C4;">catch</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">Exception</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">e</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#F286C4;">try</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#7B7F8B;">// é‡è¯•ï¼Œç­‰å¾… 10 ç§’</span></span>
<span class="line"><span style="color:#F6F6F4;">                    TimeUnit.SECONDS.</span><span style="color:#62E884;">sleep</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">10</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">                } </span><span style="color:#F286C4;">catch</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">InterruptedException</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">ie</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                    Thread.</span><span style="color:#62E884;">currentThread</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">interrupt</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">                }</span></span>
<span class="line"><span style="color:#F6F6F4;">            }</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// å…³é—­å¯åŠ¨æ‰§è¡Œå™¨</span></span>
<span class="line"><span style="color:#F6F6F4;">        bootstrapExecutor.</span><span style="color:#62E884;">shutdown</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// HTTP æœåŠ¡å™¨ä¸»è¦ä»»åŠ¡ç±»</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">static</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">class</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;">ServerThread</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">implements</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Runnable</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// ä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">private</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">ServerSocket</span><span style="color:#F6F6F4;"> serverSocket;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// æ„é€ å‡½æ•°</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">ServerThread</span><span style="color:#F6F6F4;">(</span><span style="color:#97E1F1;font-style:italic;">ServerSocket</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">s</span><span style="color:#F6F6F4;">) </span><span style="color:#F286C4;">throws</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">IOException</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#BF9EEE;font-style:italic;">this</span><span style="color:#F6F6F4;">.serverSocket </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> s;</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#7B7F8B;">// ä»»åŠ¡ä¸»ä½“æ–¹æ³•</span></span>
<span class="line"><span style="color:#F6F6F4;">        @</span><span style="color:#97E1F1;font-style:italic;">Override</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">public</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">void</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">run</span><span style="color:#F6F6F4;">() {</span></span>
<span class="line"><span style="color:#F6F6F4;">            </span><span style="color:#F286C4;">while</span><span style="color:#F6F6F4;"> (</span><span style="color:#BF9EEE;">true</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                </span><span style="color:#F286C4;">try</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#7B7F8B;">// ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#97E1F1;font-style:italic;">Socket</span><span style="color:#F6F6F4;"> socket </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;font-style:italic;">this</span><span style="color:#F6F6F4;">.serverSocket.</span><span style="color:#62E884;">accept</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#7B7F8B;">// åˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#97E1F1;font-style:italic;">HttpTask</span><span style="color:#F6F6F4;"> eventTask </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;font-weight:bold;">new</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">HttpTask</span><span style="color:#F6F6F4;">(socket);</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#7B7F8B;">// å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#F6F6F4;">                    taskExecutor.</span><span style="color:#62E884;">submit</span><span style="color:#F6F6F4;">(eventTask);</span></span>
<span class="line"><span style="color:#F6F6F4;">                } </span><span style="color:#F286C4;">catch</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">Exception</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">e</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                    e.</span><span style="color:#62E884;">printStackTrace</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">                    </span><span style="color:#F286C4;">try</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">                        </span><span style="color:#7B7F8B;">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç­‰å¾… 1 ç§’åç»§ç»­å°è¯•</span></span>
<span class="line"><span style="color:#F6F6F4;">                        TimeUnit.SECONDS.</span><span style="color:#62E884;">sleep</span><span style="color:#F6F6F4;">(</span><span style="color:#BF9EEE;">1</span><span style="color:#F6F6F4;">);</span></span>
<span class="line"><span style="color:#F6F6F4;">                    } </span><span style="color:#F286C4;">catch</span><span style="color:#F6F6F4;"> (</span><span style="color:#97E1F1;font-style:italic;">InterruptedException</span><span style="color:#F6F6F4;"> </span><span style="color:#FFB86C;font-style:italic;">ie</span><span style="color:#F6F6F4;">) {</span></span>
<span class="line"><span style="color:#F6F6F4;">                        Thread.</span><span style="color:#62E884;">currentThread</span><span style="color:#F6F6F4;">().</span><span style="color:#62E884;">interrupt</span><span style="color:#F6F6F4;">();</span></span>
<span class="line"><span style="color:#F6F6F4;">                    }</span></span>
<span class="line"><span style="color:#F6F6F4;">                }</span></span>
<span class="line"><span style="color:#F6F6F4;">            }</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BasicHttpServer</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼Œç”¨äºå¯åŠ¨ HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService bootstrapExecutor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Executors.</span><span style="color:#6F42C1;">newSingleThreadExecutor</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService taskExecutor;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// è®¾ç½®æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> PORT </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8999</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// å¯åŠ¨ HTTP æœåŠ¡å™¨çš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">startHttpServer</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// è·å–å¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œç”¨äºè®¾ç½®çº¿ç¨‹æ± å¤§å°</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> nThreads </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Runtime.</span><span style="color:#6F42C1;">getRuntime</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">availableProcessors</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// åˆå§‹åŒ–çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼Œé˜Ÿåˆ—å¤§å°å’Œä¸¢å¼ƒç­–ç•¥</span></span>
<span class="line"><span style="color:#24292E;">        taskExecutor </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(nThreads, nThreads, </span><span style="color:#005CC5;">0L</span><span style="color:#24292E;">, TimeUnit.MILLISECONDS, </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> LinkedBlockingQueue&lt;&gt;(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ThreadPoolExecutor.</span><span style="color:#6F42C1;">DiscardPolicy</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// å¾ªç¯å°è¯•å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™ç­‰å¾…10ç§’åé‡è¯•</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                ServerSocket serverSocket </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServerSocket</span><span style="color:#24292E;">(PORT);</span></span>
<span class="line"><span style="color:#24292E;">                bootstrapExecutor.</span><span style="color:#6F42C1;">submit</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServerThread</span><span style="color:#24292E;">(serverSocket));</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">// é‡è¯•ï¼Œç­‰å¾… 10 ç§’</span></span>
<span class="line"><span style="color:#24292E;">                    TimeUnit.SECONDS.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (InterruptedException </span><span style="color:#E36209;">ie</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    Thread.</span><span style="color:#6F42C1;">currentThread</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">interrupt</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// å…³é—­å¯åŠ¨æ‰§è¡Œå™¨</span></span>
<span class="line"><span style="color:#24292E;">        bootstrapExecutor.</span><span style="color:#6F42C1;">shutdown</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// HTTP æœåŠ¡å™¨ä¸»è¦ä»»åŠ¡ç±»</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServerThread</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Runnable</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// ä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> ServerSocket serverSocket;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// æ„é€ å‡½æ•°</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServerThread</span><span style="color:#24292E;">(ServerSocket </span><span style="color:#E36209;">s</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> IOException {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.serverSocket </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> s;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// ä»»åŠ¡ä¸»ä½“æ–¹æ³•</span></span>
<span class="line"><span style="color:#24292E;">        @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">// ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span></span>
<span class="line"><span style="color:#24292E;">                    Socket socket </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.serverSocket.</span><span style="color:#6F42C1;">accept</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">// åˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’</span></span>
<span class="line"><span style="color:#24292E;">                    HttpTask eventTask </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">HttpTask</span><span style="color:#24292E;">(socket);</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">// å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#24292E;">                    taskExecutor.</span><span style="color:#6F42C1;">submit</span><span style="color:#24292E;">(eventTask);</span></span>
<span class="line"><span style="color:#24292E;">                } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6A737D;">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç­‰å¾… 1 ç§’åç»§ç»­å°è¯•</span></span>
<span class="line"><span style="color:#24292E;">                        TimeUnit.SECONDS.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                    } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (InterruptedException </span><span style="color:#E36209;">ie</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                        Thread.</span><span style="color:#6F42C1;">currentThread</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">interrupt</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨å®ç°ã€‚ä»¥ä¸‹æ˜¯å…³äºè¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½çš„è¯¦ç»†è§£é‡Šï¼š</p><p>1ã€bootstrapExecutorï¼šä¸€ä¸ªå•çº¿ç¨‹çš„ ExecutorServiceï¼Œç”¨äºæ‰§è¡Œ HTTP æœåŠ¡å™¨çš„å¯åŠ¨ä»»åŠ¡ã€‚</p><p>2ã€taskExecutorï¼šä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ã€‚çº¿ç¨‹æ± çš„å¤§å°ç­‰äºå¤„ç†å™¨å¯ç”¨æ ¸å¿ƒæ•°ï¼Œé˜Ÿåˆ—å¤§å°ä¸º100ï¼Œä½¿ç”¨ DiscardPolicy ä¸¢å¼ƒç­–ç•¥ã€‚</p><p>3ã€PORTï¼šæœåŠ¡å™¨ä¾¦å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º 8999ã€‚</p><p>4ã€startHttpServer() æ–¹æ³•ï¼š</p><pre><code>- a.åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  taskExecutor ç”¨äºå¤„ç† HTTP è¯·æ±‚ã€‚
- b.åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ª ServerSocket å®ä¾‹å¹¶ç»‘å®šåˆ°æŒ‡å®šç«¯å£ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™ç­‰å¾… 10 ç§’åé‡è¯•ã€‚
- c.å½“æˆåŠŸåˆ›å»º ServerSocket å®ä¾‹åï¼Œå°†å…¶ä½œä¸ºå‚æ•°æäº¤ç»™ bootstrapExecutor æ‰§è¡Œ ServerThread ä»»åŠ¡ã€‚
- d.å…³é—­ bootstrapExecutorã€‚
</code></pre><p>5ã€ServerThread ç±»å®ç°äº† Runnable æ¥å£ï¼Œå®ƒæ˜¯ HTTP æœåŠ¡å™¨çš„ä¸»è¦ä»»åŠ¡ï¼š - a.serverSocket æˆå‘˜å˜é‡ï¼šä¿å­˜ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ ServerSocket å®ä¾‹ã€‚ - b.run() æ–¹æ³•ï¼š - åœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œè°ƒç”¨ serverSocket.accept() æ–¹æ³•ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚ - å½“æ¥å—åˆ°ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask å®ä¾‹ï¼Œå°† Socket å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ - å°† HttpTask æäº¤ç»™ taskExecutor æ‰§è¡Œã€‚</p><p>è¿™ä¸ª HTTP æœåŠ¡å™¨çš„ä¸»è¦é€»è¾‘æ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼Œå½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª HttpTask æ¥å¤„ç†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œå¹¶å°†è¿™ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ±  taskExecutor æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥å®ç°å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„å¹¶å‘å¤„ç†ã€‚</p><p>åˆ°è¿™é‡Œï¼Œä¸€ä¸ªåŸºäº Socket å®ç°çš„ HTTP æœåŠ¡å™¨åŸºæœ¬ä¸Šå°±æ­å»ºå®Œäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œæµ‹è¯•äº†</p><h4 id="_4-æµ‹è¯•" tabindex="-1">4. æµ‹è¯• <a class="header-anchor" href="#_4-æµ‹è¯•" aria-label="Permalink to &quot;4\\. æµ‹è¯•&quot;">â€‹</a></h4><p>åšè¿™ä¸ªæœåŠ¡å™¨ï¼Œä¸»è¦æ˜¯åŸºäºé¡¹ç›® <a href="https://github.com/liuyueyi/quick-fix" target="_blank" rel="noreferrer">quick-fix</a> äº§ç”Ÿçš„ï¼Œè¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯ä¸ºäº†è§£å†³åº”ç”¨å†…éƒ¨æœåŠ¡è®¿é—®ä¸æ•°æ®è®¢æ­£ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®çš„åŸºç¡€ä¸Šè¿›è¡Œæµ‹è¯•ã€‚</p><p>ä¸€ä¸ªå®Œæ•´çš„ post è¯·æ±‚å¦‚ä¸‹</p><img src="`+t+'"><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æ‰“å°å‡ºè¿”å›å¤´çš„æƒ…å†µ</p><img src="'+c+'"><h3 id="ii-å…¶ä»–" tabindex="-1">II. å…¶ä»– <a class="header-anchor" href="#ii-å…¶ä»–" aria-label="Permalink to &quot;II. å…¶ä»–&quot;">â€‹</a></h3><h4 id="_0-é¡¹ç›®æºç " tabindex="-1">0. é¡¹ç›®æºç  <a class="header-anchor" href="#_0-é¡¹ç›®æºç " aria-label="Permalink to &quot;0\\. é¡¹ç›®æºç &quot;">â€‹</a></h4><ul><li><a href="https://github.com/liuyueyi/quick-fix" target="_blank" rel="noreferrer">quick-fix</a></li><li>ç›¸å…³ä»£ç :</li><li>com.git.hui.fix.core.endpoint.BasicHttpServer</li><li>com.git.hui.fix.core.endpoint.HttpMessageParser</li><li>com.git.hui.fix.core.endpoint.HttpTask</li></ul>',87),F=[y];function i(E,u,d,B,C,D){return n(),a("div",null,F)}const T=s(r,[["render",i]]);export{A as __pageData,T as default};
